import{ai as g}from"./index.a9029666.js";import{E as c}from"./errortype.7fda15b6.js";import{c as n,q as h,w as f,g as l,d,a,s as m,b as w,e as E,f as R}from"./user-store.735d9c86.js";var y=(e=>(e[e.ReferenceExists=0]="ReferenceExists",e))(y||{});const S=g("product",{state:()=>({products:[],error:null,isLoading:!1,storeId:""}),actions:{async loadProducts(e){this.storeId=e,this.products=[],this.isLoading=!0;const s=n(a,"products"),t=h(s,f("storeId","==",e)),o=await l(t);this.products=o.docs.map(function(r){return{id:r.id,name:r.data().name,quantity:r.data().quantity,sellPrice:r.data().sellPrice,reference:r.data().reference,providerReference:r.data().providerReference,storeId:r.data().storeId,lastChangeUserId:r.data().lastChangeUserId}}),this.isLoading=!1},async referenceExists(e,s){const t=n(a,"products"),o=h(t,f("storeId","==",e),f("reference","==",s));return!(await l(o)).empty},async addProduct(e){if(await this.referenceExists(e.storeId,e.reference))throw{messageKey:y.ReferenceExists,productReference:e.reference,errorType:c.Business};try{const t=d(n(a,"products"));return e.id=t.id,await m(t,e),this.products.push(e),e}catch(t){throw{productReference:e.reference,errorType:c.Technical,message:t.toString()}}},async editProduct(e){try{const s=d(n(a,"products"),e.id);await w(s,{name:e.name,providerReference:e.providerReference,sellPrice:e.sellPrice,lastChangeUserId:e.lastChangeUserId});const t=this.products.findIndex(r=>r.id===e.id&&r.storeId===e.storeId);if(t<0)throw{productReference:e.reference,errorType:c.Technical,message:"productStore.editProduct : cannot find product in store to edit it"};const o=this.products[t];o.name=e.name,o.providerReference=e.providerReference,o.sellPrice=e.sellPrice,o.lastChangeUserId=e.lastChangeUserId}catch(s){throw{productReference:e.reference,errorType:c.Technical,message:s.toString()}}},async updateStock(e,s,t){var o;try{const r=d(a,"products",e),i=await E(r),u=t||R(a),p=d(n(a,"products",e,"stockLogs"));s.id=p.id,s.initialQuantity=Number(((o=i==null?void 0:i.data())==null?void 0:o.quantity)||0),u.set(p,s),u.update(r,{quantity:s.initialQuantity+s.adjustment}),t===void 0&&await u.commit()}catch(r){throw{productReference:e,errorType:c.Technical,message:r.toString()}}}}});export{y as P,S as u};
