import{Q as z}from"./QPage.846a834e.js";import{Q}from"./QDrawer.db020ac2.js";import{d as g,O as k,w as F,o as B,c as E,r as v,_ as R,H as $,S as M,j as t,J as i,P as b,aj as f,Q as D,R as P,M as S,G as y,I as V,ak as O,al as G,am as K,K as H,F as A}from"./index.d9beb1c5.js";import{Q as J,a as C,S as q}from"./SidePanel.71ad6aca.js";import{Q as L,a as W,E as X}from"./errortype.28c52496.js";import{u as U,P as Y}from"./product-store.2a58c4ea.js";import{u as N}from"./vue-i18n.runtime.3500c6ba.js";import{Q as T}from"./QForm.61e588dd.js";import{P as I}from"./PriceInput.8803fdbd.js";import{t as w}from"./index.161d8075.js";import{u as Z}from"./notify-handler.6890384d.js";import"./QItem.a08691c9.js";const _=g({name:"ProductGrid",emits:["new-product-click","edit-row-click","detail-row-click","duplicate-row-click"],setup(){const{t:e}=N(),o=U(),n=k(),d=[{name:"actions",label:"",align:"center"},{name:"reference",label:e("product.reference"),field:"reference",sortable:!0},{name:"providerreference",label:e("product.providerRef"),field:"providerReference",sortable:!0},{name:"name",label:e("product.name"),field:"name",sortable:!0},{name:"quantity",label:e("product.quantity"),field:"quantity",sortable:!0},{name:"sellprice",label:e("product.sellPrice"),field:"sellPrice",format:r=>`${r} \u20AC`}],a=()=>{o.loadProducts(n.currentStore)};F(()=>n.currentStore,()=>{a()}),B(()=>{n.currentStore!=null&&a()});const m=E(()=>o.products.map(function(r){return{...r,actions:null}}));return{filter:v(""),columns:d,rows:m,loadProducts:a,loading:o.isLoading}}}),x={class:"q-pa-md"},ee={class:"text-body2"},oe={class:"text-body2"},le={class:"text-body2"};function te(e,o,n,d,a,m){return $(),M("div",x,[t(W,{class:"body--light","grid-header":"",bordered:"",rows:e.rows,columns:e.columns,"row-key":"reference",filter:e.filter,"rows-per-page-options":[50,100]},{top:i(()=>[t(b,{"data-testid":"newproductbtn",color:"primary",label:e.$t("product.newProduct"),onClick:o[0]||(o[0]=r=>e.$emit("new-product-click"))},null,8,["label"]),t(J),t(f,{"data-testid":"searchproductinput",dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=r=>e.filter=r)},{append:i(()=>[t(D,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":i(r=>[t(L,{props:r},{default:i(()=>[t(b,{"data-testid":"editproductbtn",class:"q-mr-sm",icon:"edit",push:"",round:"",color:"amber-7",size:"sm",onClick:u=>e.$emit("edit-row-click",r.row)},{default:i(()=>[t(C,null,{default:i(()=>[P("div",ee,S(e.$t("buttons.edit")),1)]),_:1})]),_:2},1032,["onClick"]),t(b,{"data-testid":"detailproductbtn",icon:"visibility",class:"q-mr-sm",push:"",round:"",color:"primary",size:"sm",onClick:u=>e.$emit("detail-row-click",r.row)},{default:i(()=>[t(C,null,{default:i(()=>[P("div",oe,S(e.$t("buttons.detail")),1)]),_:1})]),_:2},1032,["onClick"]),t(b,{"data-testid":"duplicateproductbtn",icon:"copy_all",round:"",push:"",color:"grey",size:"sm",onClick:u=>e.$emit("duplicate-row-click",r.row)},{default:i(()=>[t(C,null,{default:i(()=>[P("div",le,S(e.$t("buttons.duplicate")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])])}var re=R(_,[["render",te]]);const de=g({name:"ProductCreation",props:{modelValue:{type:Object,required:!1}},emits:["close","update:modelValue","product-creation-failed"],components:{SidePanel:q,PriceInput:I},setup(e,o){const n=v(),d=v({reference:"",providerReference:"",sellPrice:0,name:""});F(()=>e.modelValue,l=>{d.value.reference=(l==null?void 0:l.reference)||"",d.value.providerReference=(l==null?void 0:l.providerReference)||"",d.value.name=(l==null?void 0:l.name)||"",d.value.sellPrice=(l==null?void 0:l.sellPrice)||0});const a=U(),m=k(),r=()=>{var l;d.value.reference="",d.value.providerReference="",d.value.sellPrice=0,d.value.name="",(l=n.value)==null||l.resetValidation()};return{form:n,formFields:d,onSubmit:async()=>{var l;try{const s={quantity:0,storeId:m.currentStore,lastChangeUserId:(l=m.userData)==null?void 0:l.uid,...d.value},h=await a.addProduct(s);r(),o.emit("update:modelValue",h)}catch(s){o.emit("product-creation-failed",s)}}}}}),ne={class:"row justify-center"};function ae(e,o,n,d,a,m){const r=y("price-input"),u=y("side-panel");return $(),V(u,{title:e.$t("product.newProduct"),onClose:o[4]||(o[4]=l=>e.$emit("close"))},{default:i(()=>[t(T,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:i(()=>[t(f,{filled:"",modelValue:e.formFields.reference,"onUpdate:modelValue":o[0]||(o[0]=l=>e.formFields.reference=l),label:e.$t("product.reference"),"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),t(f,{filled:"",modelValue:e.formFields.providerReference,"onUpdate:modelValue":o[1]||(o[1]=l=>e.formFields.providerReference=l),label:e.$t("product.providerReference")},null,8,["modelValue","label"]),t(f,{filled:"",modelValue:e.formFields.name,"onUpdate:modelValue":o[2]||(o[2]=l=>e.formFields.name=l),label:e.$t("product.name"),"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),t(r,{modelValue:e.formFields.sellPrice,"onUpdate:modelValue":o[3]||(o[3]=l=>e.formFields.sellPrice=l),label:e.$t("product.sellPrice")},null,8,["modelValue","label"]),P("div",ne,[t(b,{label:e.$t("buttons.create"),type:"submit",color:"primary"},null,8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var ie=R(de,[["render",ae]]);const se=g({name:"ProductEdit",props:{readonlyMode:{type:Boolean,default:!1},modelValue:{type:Object,required:!0}},emits:["close","update:modelValue","update:readonlyMode","product-edit-failed"],components:{SidePanel:q,PriceInput:I},setup(e,o){const n=E(()=>e.modelValue),d=O(e.readonlyMode);G(()=>d.value=e.readonlyMode);const a=U(),m=k();return{editing:n,isReadonly:d,onSubmit:async()=>{var u;try{n.value.lastChangeUserId=(u=m.userData)==null?void 0:u.uid,await a.editProduct(n.value),o.emit("update:modelValue",n.value)}catch(l){o.emit("product-edit-failed",l)}}}}}),ue={class:"row"},me={class:"row justify-center"};function ce(e,o,n,d,a,m){const r=y("price-input"),u=y("side-panel");return $(),V(u,{title:e.$t("product.detail"),onClose:o[5]||(o[5]=l=>e.$emit("close"))},{default:i(()=>[P("div",ue,[t(K,{class:"","model-value":e.isReadonly,color:"green",label:e.$t("forms.editMode"),"true-value":!1,"false-value":!0,"onUpdate:modelValue":o[0]||(o[0]=l=>e.$emit("update:readonlyMode",e.isReadonly))},null,8,["model-value","label"])]),t(T,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:i(()=>[t(f,{filled:"","data-testid":"referenceinput",modelValue:e.editing.reference,"onUpdate:modelValue":o[1]||(o[1]=l=>e.editing.reference=l),label:e.$t("product.reference"),readonly:"","lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),t(f,{filled:"","data-testid":"providerrefinput",modelValue:e.editing.providerReference,"onUpdate:modelValue":o[2]||(o[2]=l=>e.editing.providerReference=l),readonly:e.isReadonly,label:e.$t("product.providerReference")},null,8,["modelValue","readonly","label"]),t(f,{filled:"","data-testid":"nameinput",modelValue:e.editing.name,"onUpdate:modelValue":o[3]||(o[3]=l=>e.editing.name=l),label:e.$t("product.name"),readonly:e.isReadonly,"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","readonly","rules"]),t(r,{"data-testid":"sellpriceinput",modelValue:e.editing.sellPrice,"onUpdate:modelValue":o[4]||(o[4]=l=>e.editing.sellPrice=l),label:e.$t("product.sellPrice")},null,8,["modelValue","label"]),P("div",me,[e.isReadonly?H("",!0):($(),V(b,{key:0,"data-testid":"modifybtn",label:e.$t("buttons.edit"),type:"submit",color:"primary"},null,8,["label"]))])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var pe=R(se,[["render",ce]]);function fe(e){return e.errorType===X.Technical?(console.log(e),w("common.technicalError")):(e==null?void 0:e.messageKey)===Y.ReferenceExists?w("product.referenceExists"):w("common.technicalError")}const ye=g({name:"ProductsPage",components:{ProductGrid:re,ProductCreation:ie,ProductEdit:pe},setup(){const{t:e}=N(),o=Z(),n={id:"",name:"",quantity:0,sellPrice:0,reference:"",storeId:"",providerReference:"",lastChangeUserId:""},d=v(n);var a=v(null);const m=(c,p)=>{a.value=c;let j=Object.create(p);d.value=j},r=()=>{a.value=null,d.value=n},u=c=>{let p=Object.create(n);p.reference=c.reference,p.providerReference=c.providerReference,p.name=c.name,p.sellPrice=c.sellPrice,m("new",p)},l=E(()=>a.value==="detail");return{handleTechnicalError:c=>o.NotifyError(fe(c)),handleNewProduct:()=>{o.NotifySuccess(e("product.created")),r()},handleProductEdited:()=>{o.NotifySuccess(e("product.edited")),r()},sidePanel:a,openSidePanel:m,closeSidePanel:r,emptyRow:n,editingRow:d,readonlyEditMode:l,handleEditModeChanged:c=>{a.value=c?"edit":"detail"},duplicateProduct:u}}});function be(e,o,n,d,a,m){const r=y("product-grid"),u=y("product-creation"),l=y("product-edit");return $(),M(A,null,[t(z,null,{default:i(()=>[t(r,{onNewProductClick:o[0]||(o[0]=s=>e.openSidePanel("new",e.emptyRow)),onEditRowClick:o[1]||(o[1]=s=>e.openSidePanel("edit",s)),onDetailRowClick:o[2]||(o[2]=s=>e.openSidePanel("detail",s)),onDuplicateRowClick:o[3]||(o[3]=s=>e.duplicateProduct(s))})]),_:1}),t(Q,{"model-value":e.sidePanel==="new",side:"right",bordered:""},{default:i(()=>[t(u,{modelValue:e.editingRow,"onUpdate:modelValue":[o[4]||(o[4]=s=>e.editingRow=s),e.handleNewProduct],onProductCreationFailed:e.handleTechnicalError,onClose:e.closeSidePanel},null,8,["modelValue","onUpdate:modelValue","onProductCreationFailed","onClose"])]),_:1},8,["model-value"]),t(Q,{"model-value":e.sidePanel==="edit"||e.sidePanel==="detail",side:"right",bordered:""},{default:i(()=>[t(l,{modelValue:e.editingRow,"onUpdate:modelValue":[o[5]||(o[5]=s=>e.editingRow=s),e.handleProductEdited],"readonly-mode":e.readonlyEditMode,onClose:e.closeSidePanel,"onUpdate:readonlyMode":e.handleEditModeChanged,onProductEditFailed:e.handleTechnicalError},null,8,["modelValue","readonly-mode","onClose","onUpdate:modelValue","onUpdate:readonlyMode","onProductEditFailed"])]),_:1},8,["model-value"])],64)}var Fe=R(ye,[["render",be]]);export{Fe as default};
