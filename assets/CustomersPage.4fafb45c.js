import{Q as F}from"./QPage.2af27f98.js";import{Q}from"./QDrawer.a6cb990e.js";import{d as g,O as R,w as B,o as D,c as w,r as c,_ as V,H as $,S as M,j as t,J as s,P as y,ap as p,Q as j,R as b,M as S,G as C,I as h,aq as z,ar as G,as as H,K as J,N as K,F as L}from"./index.16c6c9b9.js";import{Q as A,a as k,S as N}from"./SidePanel.d4726d84.js";import{Q as W,a as X}from"./errortype.9ba1b0bd.js";import{u as E}from"./customer-store.52e0e272.js";import{u as I}from"./vue-i18n.runtime.d7d53555.js";import{Q as q}from"./QForm.b82c6802.js";import{u as Y}from"./notify-handler.50ef248f.js";import{u as Z}from"./use-dialog-plugin-component.d13d1f73.js";import"./QItem.2290178a.js";const _=g({name:"CustomerGrid",emits:["new-customer-click","edit-row-click","detail-row-click","order-row-click"],setup(){const{t:e}=I(),o=E(),n=R(),a=[{name:"actions",label:"",align:"center"},{name:"name",label:e("customer.name"),field:"name",sortable:!0},{name:"address",label:e("customer.address"),field:"address"},{name:"country",label:e("customer.country"),field:"country"},{name:"email",label:e("customer.email"),field:"email",sortable:!0},{name:"phone",label:e("customer.phone"),field:"phone",sortable:!0}],i=()=>{o.loadCustomers(n.currentStore)};B(()=>n.currentStore,()=>{i()}),D(()=>{n.currentStore!=null&&i()});const u=w(()=>o.customers.map(function(r){return{...r,actions:null}}));return{filter:c(""),columns:a,rows:u,loadCustomers:i,loading:w(()=>o.isLoading)}}}),x={class:"q-pa-md"},ee={class:"text-body2"},oe={class:"text-body2"},le={class:"text-body2"};function te(e,o,n,a,i,u){return $(),M("div",x,[t(X,{"grid-header":"",bordered:"",rows:e.rows,columns:e.columns,"row-key":"reference",filter:e.filter,"rows-per-page-options":[50,100]},{top:s(()=>[t(y,{color:"primary",label:e.$t("customer.newCustomer"),onClick:o[0]||(o[0]=r=>e.$emit("new-customer-click"))},null,8,["label"]),t(A),t(p,{dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=r=>e.filter=r)},{append:s(()=>[t(j,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":s(r=>[t(W,{props:r},{default:s(()=>[t(y,{class:"q-mr-sm",icon:"edit",push:"",round:"",color:"amber-7",size:"sm",onClick:l=>e.$emit("edit-row-click",r.row)},{default:s(()=>[t(k,null,{default:s(()=>[b("div",ee,S(e.$t("buttons.edit")),1)]),_:1})]),_:2},1032,["onClick"]),t(y,{icon:"visibility",class:"q-mr-sm",push:"",round:"",color:"primary",size:"sm",onClick:l=>e.$emit("detail-row-click",r.row)},{default:s(()=>[t(k,null,{default:s(()=>[b("div",oe,S(e.$t("buttons.detail")),1)]),_:1})]),_:2},1032,["onClick"]),t(y,{icon:"shopping_bag",class:"q-mr-sm",push:"",round:"",color:"green",size:"sm",onClick:l=>e.$emit("order-row-click",r.row)},{default:s(()=>[t(k,null,{default:s(()=>[b("div",le,S(e.$t("buttons.order")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])])}var re=V(_,[["render",te]]);const ne=g({name:"CustomerCreation",emits:["close","customer-created","customer-creation-failed"],components:{SidePanel:N},setup(e,o){const n=c(),a=c({id:"",name:"",address:"",country:"",storeId:"",email:"",phone:""}),i=E(),u=R(),r=()=>{var m;a.value.name="",a.value.address="",a.value.country="",a.value.email="",a.value.phone="",(m=n.value)==null||m.resetValidation()};return{form:n,customer:a,onSubmit:async()=>{var m;try{const{storeId:d,...v}=a.value,U={storeId:u.currentStore,lastChangeUserId:(m=u.userData)==null?void 0:m.uid,...v},P=await i.addCustomer(U);o.emit("customer-created",P),r()}catch(d){console.log(d),o.emit("customer-creation-failed",d)}}}}}),ae={class:"row justify-center"};function se(e,o,n,a,i,u){const r=C("side-panel");return $(),h(r,{title:e.$t("customer.newCustomer"),onClose:o[5]||(o[5]=l=>e.$emit("close"))},{default:s(()=>[t(q,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:s(()=>[t(p,{filled:"",modelValue:e.customer.name,"onUpdate:modelValue":o[0]||(o[0]=l=>e.customer.name=l),label:e.$t("customer.name"),"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),t(p,{filled:"",modelValue:e.customer.address,"onUpdate:modelValue":o[1]||(o[1]=l=>e.customer.address=l),label:e.$t("customer.address")},null,8,["modelValue","label"]),t(p,{filled:"",modelValue:e.customer.country,"onUpdate:modelValue":o[2]||(o[2]=l=>e.customer.country=l),label:e.$t("customer.country")},null,8,["modelValue","label"]),t(p,{filled:"",modelValue:e.customer.email,"onUpdate:modelValue":o[3]||(o[3]=l=>e.customer.email=l),label:e.$t("customer.email")},null,8,["modelValue","label"]),t(p,{filled:"",modelValue:e.customer.phone,"onUpdate:modelValue":o[4]||(o[4]=l=>e.customer.phone=l),label:e.$t("customer.phone")},null,8,["modelValue","label"]),b("div",ae,[t(y,{label:e.$t("buttons.create"),type:"submit",color:"primary"},null,8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var de=V(ne,[["render",se]]);const ue=g({name:"CustomerEdit",props:{readonlyMode:{type:Boolean,default:!1},modelValue:{type:Object,required:!0}},emits:["close","update:modelValue","update:readonlyMode","customer-edit-failed"],components:{SidePanel:N},setup(e,o){const n=w(()=>e.modelValue),a=z(e.readonlyMode);G(()=>a.value=e.readonlyMode);const i=E(),u=R();return{editing:n,isReadonly:a,onSubmit:async()=>{var l;try{n.value.lastChangeUserId=(l=u.userData)==null?void 0:l.uid,await i.editCustomer(n.value),o.emit("update:modelValue",n.value)}catch(m){o.emit("customer-edit-failed",m)}}}}}),ie={class:"row"},me={class:"row justify-center"};function pe(e,o,n,a,i,u){const r=C("side-panel");return $(),h(r,{title:e.$t("customer.detail"),onClose:o[6]||(o[6]=l=>e.$emit("close"))},{default:s(()=>[b("div",ie,[t(H,{class:"","model-value":e.isReadonly,color:"green",label:e.$t("forms.editMode"),"true-value":!1,"false-value":!0,"onUpdate:modelValue":o[0]||(o[0]=l=>e.$emit("update:readonlyMode",e.isReadonly))},null,8,["model-value","label"])]),t(q,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:s(()=>[t(p,{filled:"",modelValue:e.editing.name,"onUpdate:modelValue":o[1]||(o[1]=l=>e.editing.name=l),label:e.$t("customer.name"),readonly:e.isReadonly,"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","readonly","rules"]),t(p,{filled:"",modelValue:e.editing.address,"onUpdate:modelValue":o[2]||(o[2]=l=>e.editing.address=l),readonly:e.isReadonly,label:e.$t("customer.address")},null,8,["modelValue","readonly","label"]),t(p,{filled:"",modelValue:e.editing.country,"onUpdate:modelValue":o[3]||(o[3]=l=>e.editing.country=l),readonly:e.isReadonly,label:e.$t("customer.country")},null,8,["modelValue","readonly","label"]),t(p,{filled:"",modelValue:e.editing.email,"onUpdate:modelValue":o[4]||(o[4]=l=>e.editing.email=l),readonly:e.isReadonly,label:e.$t("customer.email")},null,8,["modelValue","readonly","label"]),t(p,{filled:"",modelValue:e.editing.phone,"onUpdate:modelValue":o[5]||(o[5]=l=>e.editing.phone=l),label:e.$t("customer.phone"),readonly:e.isReadonly},null,8,["modelValue","label","readonly"]),b("div",me,[e.isReadonly?J("",!0):($(),h(y,{key:0,label:e.$t("buttons.edit"),type:"submit",color:"primary"},null,8,["label"]))])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var ce=V(ue,[["render",pe]]);const fe=g({name:"CustomersPage",components:{CustomerGrid:re,CustomerCreation:de,CustomerEdit:ce},emits:[...Z.emits],setup(){const{t:e}=I(),o=K(),n=Y(),a=c(!1),i=c(),u={id:"",name:"",storeId:"",lastChangeUserId:""},r=c(u);var l=c(null);const m=(f,O)=>{l.value=f;let T=Object.create(O);r.value=T},d=()=>{l.value=null,r.value=u},v=w(()=>l.value==="detail");return{handleTechnicalError:f=>{n.NotifyError("error")},handleNewCustomer:()=>{n.NotifySuccess(e("customer.created")),d()},handleCustomerEdited:()=>{n.NotifySuccess(e("customer.edited")),d()},sidePanel:l,openSidePanel:m,closeSidePanel:d,emptyRow:u,editingRow:r,readonlyEditMode:v,handleEditModeChanged:f=>{l.value=f?"edit":"detail"},dialogOpened:a,selectedCustomer:i,openNewOrder:f=>{o.push({name:"customer-newsale",params:{customerId:f.id}})}}}});function ye(e,o,n,a,i,u){const r=C("customer-grid"),l=C("customer-creation"),m=C("customer-edit");return $(),M(L,null,[t(F,null,{default:s(()=>[t(r,{onNewCustomerClick:o[0]||(o[0]=d=>e.openSidePanel("new",e.emptyRow)),onEditRowClick:o[1]||(o[1]=d=>e.openSidePanel("edit",d)),onDetailRowClick:o[2]||(o[2]=d=>e.openSidePanel("detail",d)),onOrderRowClick:o[3]||(o[3]=d=>e.openNewOrder(d))})]),_:1}),t(Q,{"model-value":e.sidePanel==="new",side:"right",bordered:""},{default:s(()=>[t(l,{onCustomerCreated:e.handleNewCustomer,onCustomerCreationFailed:e.handleTechnicalError,onClose:e.closeSidePanel},null,8,["onCustomerCreated","onCustomerCreationFailed","onClose"])]),_:1},8,["model-value"]),t(Q,{"model-value":e.sidePanel==="edit"||e.sidePanel==="detail",side:"right",bordered:""},{default:s(()=>[t(m,{modelValue:e.editingRow,"onUpdate:modelValue":[o[4]||(o[4]=d=>e.editingRow=d),e.handleCustomerEdited],"readonly-mode":e.readonlyEditMode,onClose:e.closeSidePanel,"onUpdate:readonlyMode":e.handleEditModeChanged,onCustomerEditFailed:e.handleTechnicalError},null,8,["modelValue","readonly-mode","onClose","onUpdate:modelValue","onUpdate:readonlyMode","onCustomerEditFailed"])]),_:1},8,["model-value"])],64)}var Qe=V(fe,[["render",ye]]);export{Qe as default};
