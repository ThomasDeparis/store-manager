import{Q as F}from"./QPage.c5ade77a.js";import{Q as U}from"./QDrawer.d37ed123.js";import{d as C,c as g,r as m,_ as V,H as P,R as N,j as l,J as a,O as c,aj as y,Q as j,P as $,M as h,G as b,I as k,ak as B,al as D,am as z,K as G,N as H,F as J}from"./index.3db6d354.js";import{Q as K,a as S}from"./QTooltip.1c55f155.js";import{Q as L,a as A}from"./errortype.ca0a8788.js";import{u as E}from"./provider-store.e766446d.js";import{u as R}from"./user-store.7c7798a7.js";import{u as M}from"./vue-i18n.runtime.f032216e.js";import{Q as I}from"./QForm.1abbfd2a.js";import{S as q}from"./SidePanel.105ac781.js";import{t as W}from"./index.e5b097fe.js";import{u as X}from"./notify-handler.3dcb331b.js";import{u as Y}from"./use-dialog-plugin-component.d7ff1950.js";import"./QItem.02ecd005.js";const Z=C({name:"ProviderGrid",emits:["new-provider-click","edit-row-click","detail-row-click","order-row-click"],setup(){const{t:e}=M(),o=E(),d=R(),t=[{name:"actions",label:"",align:"center"},{name:"name",label:e("provider.name"),field:"name",sortable:!0},{name:"phone",label:e("provider.phone"),field:"phone"},{name:"email",label:e("provider.email"),field:"email",sortable:!0}],s=()=>{o.loadProviders(d.currentStore)},i=g(()=>o.providers.map(function(n){return{...n,actions:null}}));return{filter:m(""),columns:t,rows:i,loadProviders:s,loading:g(()=>o.isLoading)}}}),_={class:"q-pa-md"},x={class:"text-body2"},ee={class:"text-body2"},oe={class:"text-body2"};function re(e,o,d,t,s,i){return P(),N("div",_,[l(A,{"grid-header":"",bordered:"",rows:e.rows,columns:e.columns,"row-key":"reference",filter:e.filter,"rows-per-page-options":[50,100]},{top:a(()=>[l(c,{color:"primary",label:e.$t("provider.newProvider"),onClick:o[0]||(o[0]=n=>e.$emit("new-provider-click"))},null,8,["label"]),l(K),l(y,{dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=n=>e.filter=n)},{append:a(()=>[l(j,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":a(n=>[l(L,{props:n},{default:a(()=>[l(c,{class:"q-mr-sm",icon:"edit",push:"",round:"",color:"amber-7",size:"sm",onClick:r=>e.$emit("edit-row-click",n.row)},{default:a(()=>[l(S,null,{default:a(()=>[$("div",x,h(e.$t("buttons.edit")),1)]),_:1})]),_:2},1032,["onClick"]),l(c,{icon:"visibility",class:"q-mr-sm",push:"",round:"",color:"primary",size:"sm",onClick:r=>e.$emit("detail-row-click",n.row)},{default:a(()=>[l(S,null,{default:a(()=>[$("div",ee,h(e.$t("buttons.detail")),1)]),_:1})]),_:2},1032,["onClick"]),l(c,{icon:"shopping_cart",class:"q-mr-sm",push:"",round:"",color:"green",size:"sm",onClick:r=>e.$emit("order-row-click",n.row)},{default:a(()=>[l(S,null,{default:a(()=>[$("div",oe,h(e.$t("buttons.order")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),l(c,{icon:"search",onClick:e.loadProviders},null,8,["onClick"])])}var le=V(Z,[["render",re]]);const ne=C({name:"ProviderCreation",emits:["close","provider-created","provider-creation-failed"],components:{SidePanel:q},setup(e,o){const d=m(),t=m(""),s=m(""),i=m(""),n=E(),r=R(),v=()=>{var f;t.value="",s.value="",i.value="",(f=d.value)==null||f.resetValidation()};return{form:d,email:t,phone:s,name:i,onSubmit:async()=>{var f;try{const w={email:t.value,phone:s.value,name:i.value,storeId:r.currentStore,lastChangeUserId:(f=r.userData)==null?void 0:f.uid},Q=await n.addProvider(w);o.emit("provider-created",Q),v()}catch(w){o.emit("provider-creation-failed",w)}}}}}),de={class:"row justify-center"};function ae(e,o,d,t,s,i){const n=b("side-panel");return P(),k(n,{title:e.$t("provider.newProvider"),onClose:o[3]||(o[3]=r=>e.$emit("close"))},{default:a(()=>[l(I,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:a(()=>[l(y,{filled:"",modelValue:e.email,"onUpdate:modelValue":o[0]||(o[0]=r=>e.email=r),label:e.$t("provider.email")},null,8,["modelValue","label"]),l(y,{filled:"",modelValue:e.name,"onUpdate:modelValue":o[1]||(o[1]=r=>e.name=r),label:e.$t("provider.name"),"lazy-rules":"",rules:[r=>r&&r.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),l(y,{filled:"",prefix:"+33",mask:"# ## ## ## ##","reverse-fill-mask":"",modelValue:e.phone,"onUpdate:modelValue":o[2]||(o[2]=r=>e.phone=r),label:e.$t("provider.phone")},null,8,["modelValue","label"]),$("div",de,[l(c,{label:e.$t("buttons.create"),type:"submit",color:"primary"},null,8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var ie=V(ne,[["render",ae]]);const te=C({name:"ProviderEdit",props:{readonlyMode:{type:Boolean,default:!1},modelValue:{type:Object,required:!0}},emits:["close","update:modelValue","update:readonlyMode","provider-edit-failed"],components:{SidePanel:q},setup(e,o){const d=g(()=>e.modelValue),t=B(e.readonlyMode);D(()=>t.value=e.readonlyMode);const s=E(),i=R();return{editing:d,isReadonly:t,onSubmit:async()=>{var r;try{d.value.lastChangeUserId=(r=i.userData)==null?void 0:r.uid,await s.editProvider(d.value),o.emit("update:modelValue",d.value)}catch(v){o.emit("provider-edit-failed",v)}}}}}),se={class:"row"},ue={class:"row justify-center"};function me(e,o,d,t,s,i){const n=b("side-panel");return P(),k(n,{title:e.$t("provider.detail"),onClose:o[4]||(o[4]=r=>e.$emit("close"))},{default:a(()=>[$("div",se,[l(z,{class:"","model-value":e.isReadonly,color:"green",label:e.$t("forms.editMode"),"true-value":!1,"false-value":!0,"onUpdate:modelValue":o[0]||(o[0]=r=>e.$emit("update:readonlyMode",e.isReadonly))},null,8,["model-value","label"])]),l(I,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:a(()=>[l(y,{filled:"",modelValue:e.editing.email,"onUpdate:modelValue":o[1]||(o[1]=r=>e.editing.email=r),readonly:e.isReadonly,label:e.$t("provider.email")},null,8,["modelValue","readonly","label"]),l(y,{filled:"",modelValue:e.editing.name,"onUpdate:modelValue":o[2]||(o[2]=r=>e.editing.name=r),label:e.$t("provider.name"),readonly:e.isReadonly,"lazy-rules":"",rules:[r=>r&&r.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","readonly","rules"]),l(y,{filled:"",prefix:"+33",mask:"# ## ## ## ##","reverse-fill-mask":"",modelValue:e.editing.phone,"onUpdate:modelValue":o[3]||(o[3]=r=>e.editing.phone=r),label:e.$t("provider.phone"),readonly:e.isReadonly},null,8,["modelValue","label","readonly"]),$("div",ue,[e.isReadonly?G("",!0):(P(),k(c,{key:0,label:e.$t("buttons.edit"),type:"submit",color:"primary"},null,8,["label"]))])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var pe=V(te,[["render",me]]);function ve(e){return console.log(e),W("common.technicalError")}const fe=C({name:"ProvidersPage",components:{ProviderGrid:le,ProviderCreation:ie,ProviderEdit:pe},emits:[...Y.emits],setup(){const{t:e}=M(),o=H(),d=X(),t=m(!1),s=m(),i={id:"",name:"",storeId:"",lastChangeUserId:"",email:"",phone:""},n=m(i);var r=m(null);const v=(p,O)=>{r.value=p;let T=Object.create(O);n.value=T},u=()=>{r.value=null,n.value=i},f=g(()=>r.value==="detail");return{handleTechnicalError:p=>d.NotifyError(ve(p)),handleNewProvider:()=>{d.NotifySuccess(e("provider.created"))},handleProviderEdited:()=>{d.NotifySuccess(e("provider.edited")),u()},sidePanel:r,openSidePanel:v,closeSidePanel:u,emptyRow:i,editingRow:n,readonlyEditMode:f,handleEditModeChanged:p=>{console.log("nouveau mode"),console.log(p),r.value=p?"edit":"detail"},dialogOpened:t,selectedProvider:s,openNewOrder:p=>{o.push({name:"provider-neworder",params:{providerId:p.id}})}}}});function ce(e,o,d,t,s,i){const n=b("provider-grid"),r=b("provider-creation"),v=b("provider-edit");return P(),N(J,null,[l(F,null,{default:a(()=>[l(n,{onNewProviderClick:o[0]||(o[0]=u=>e.openSidePanel("new",e.emptyRow)),onEditRowClick:o[1]||(o[1]=u=>e.openSidePanel("edit",u)),onDetailRowClick:o[2]||(o[2]=u=>e.openSidePanel("detail",u)),onOrderRowClick:o[3]||(o[3]=u=>e.openNewOrder(u))})]),_:1}),l(U,{"model-value":e.sidePanel==="new",side:"right",bordered:""},{default:a(()=>[l(r,{onProviderCreated:e.handleNewProvider,onProviderCreationFailed:e.handleTechnicalError,onClose:e.closeSidePanel},null,8,["onProviderCreated","onProviderCreationFailed","onClose"])]),_:1},8,["model-value"]),l(U,{"model-value":e.sidePanel==="edit"||e.sidePanel==="detail",side:"right",bordered:""},{default:a(()=>[l(v,{modelValue:e.editingRow,"onUpdate:modelValue":[o[4]||(o[4]=u=>e.editingRow=u),e.handleProviderEdited],"readonly-mode":e.readonlyEditMode,onClose:e.closeSidePanel,"onUpdate:readonlyMode":e.handleEditModeChanged,onProviderEditFailed:e.handleTechnicalError},null,8,["modelValue","readonly-mode","onClose","onUpdate:modelValue","onUpdate:readonlyMode","onProviderEditFailed"])]),_:1},8,["model-value"])],64)}var Ie=V(fe,[["render",ce]]);export{Ie as default};
