import{ai as p}from"./index.763f224d.js";import{E as c}from"./errortype.de26a0c9.js";import{c as a,q as d,w as i,g as l,d as u,a as n,s as h,b as y}from"./user-store.d4083d07.js";var f=(e=>(e[e.ReferenceExists=0]="ReferenceExists",e))(f||{});const P=p("product",{state:()=>({products:[],error:null,isLoading:!1,storeId:""}),actions:{async loadProducts(e){this.storeId=e,this.products=[],this.isLoading=!0;const o=a(n,"products"),r=d(o,i("storeId","==",e)),t=await l(r);this.products=t.docs.map(function(s){return{id:s.id,name:s.data().name,quantity:s.data().quantity,sellPrice:s.data().sellPrice,reference:s.data().reference,providerReference:s.data().providerReference,storeId:s.data().storeId,lastChangeUserId:s.data().lastChangeUserId}}),this.isLoading=!1},async referenceExists(e,o){const r=a(n,"products"),t=d(r,i("storeId","==",e),i("reference","==",o));return!(await l(t)).empty},async addProduct(e){if(await this.referenceExists(e.storeId,e.reference))throw{messageKey:f.ReferenceExists,productReference:e.reference,errorType:c.Business};try{const r=u(a(n,"products"));e.id=r.id,await h(r,e),this.products.push(e)}catch(r){throw{productReference:e.reference,errorType:c.Technical,message:r.toString()}}},async editProduct(e){try{const o=u(a(n,"products"),e.id);await y(o,{name:e.name,providerReference:e.providerReference,sellPrice:e.sellPrice,lastChangeUserId:e.lastChangeUserId});const r=this.products.findIndex(s=>s.id===e.id&&s.storeId===e.storeId);if(r<0)throw{productReference:e.reference,errorType:c.Technical,message:"productStore.editProduct : cannot find product in store to edit it"};console.log(e),console.log(e.sellPrice);const t=this.products[r];t.name=e.name,t.providerReference=e.providerReference,t.sellPrice=e.sellPrice,t.lastChangeUserId=e.lastChangeUserId}catch(o){throw{productReference:e.reference,errorType:c.Technical,message:o.toString()}}}}});export{f as P,P as u};
