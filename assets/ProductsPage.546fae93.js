import{Q as I}from"./QPage.0f706cc1.js";import{Q}from"./QDrawer.a6ea1df3.js";import{d as g,w as F,o as j,c as w,r as $,_ as R,H as v,R as M,j as r,J as s,O as y,aj as p,Q as B,P as b,M as S,G as P,I as k,ak as D,al as O,am as A,K as G,F as K}from"./index.8300ccfe.js";import{Q as H,a as C,S as q}from"./SidePanel.6b0f7ddc.js";import{Q as J,a as L,E as W}from"./errortype.eab57c96.js";import{u as E,P as X}from"./product-store.c654f249.js";import{u as h}from"./user-store.7356289a.js";import{u as N}from"./vue-i18n.runtime.3c42af3a.js";import{Q as T,u as Y}from"./notify-handler.25a51192.js";import{t as V}from"./index.416aadda.js";import"./QItem.31c283e7.js";const Z=g({name:"ProductGrid",emits:["new-product-click","edit-row-click","detail-row-click","duplicate-row-click"],setup(){const{t:e}=N(),o=E(),a=h(),n=[{name:"actions",label:"",align:"center"},{name:"reference",label:e("product.reference"),field:"reference",sortable:!0},{name:"providerreference",label:e("product.providerRef"),field:"providerReference",sortable:!0},{name:"name",label:e("product.name"),field:"name",sortable:!0},{name:"quantity",label:e("product.quantity"),field:"quantity",sortable:!0},{name:"sellprice",label:e("product.sellPrice"),field:"sellPrice",format:t=>`${t} \u20AC`}],i=()=>{o.loadProducts(a.currentStore)};F(()=>a.currentStore,()=>{i()}),j(()=>{a.currentStore!=null&&i()});const m=w(()=>o.products.map(function(t){return{...t,actions:null}}));return{filter:$(""),columns:n,rows:m,loadProducts:i,loading:o.isLoading}}}),_={class:"q-pa-md"},x={class:"text-body2"},ee={class:"text-body2"},oe={class:"text-body2"};function le(e,o,a,n,i,m){return v(),M("div",_,[r(L,{class:"body--light","grid-header":"",bordered:"",rows:e.rows,columns:e.columns,"row-key":"reference",filter:e.filter,"rows-per-page-options":[50,100]},{top:s(()=>[r(y,{"data-testid":"newproductbtn",color:"primary",label:e.$t("product.newProduct"),onClick:o[0]||(o[0]=t=>e.$emit("new-product-click"))},null,8,["label"]),r(H),r(p,{"data-testid":"searchproductinput",dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=t=>e.filter=t)},{append:s(()=>[r(B,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":s(t=>[r(J,{props:t},{default:s(()=>[r(y,{"data-testid":"editproductbtn",class:"q-mr-sm",icon:"edit",push:"",round:"",color:"amber-7",size:"sm",onClick:l=>e.$emit("edit-row-click",t.row)},{default:s(()=>[r(C,null,{default:s(()=>[b("div",x,S(e.$t("buttons.edit")),1)]),_:1})]),_:2},1032,["onClick"]),r(y,{"data-testid":"detailproductbtn",icon:"visibility",class:"q-mr-sm",push:"",round:"",color:"primary",size:"sm",onClick:l=>e.$emit("detail-row-click",t.row)},{default:s(()=>[r(C,null,{default:s(()=>[b("div",ee,S(e.$t("buttons.detail")),1)]),_:1})]),_:2},1032,["onClick"]),r(y,{"data-testid":"duplicateproductbtn",icon:"copy_all",round:"",push:"",color:"grey",size:"sm",onClick:l=>e.$emit("duplicate-row-click",t.row)},{default:s(()=>[r(C,null,{default:s(()=>[b("div",oe,S(e.$t("buttons.duplicate")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])])}var re=R(Z,[["render",le]]);const te=g({name:"ProductCreation",props:{modelValue:{type:Object,required:!1}},emits:["close","update:modelValue","product-creation-failed"],components:{SidePanel:q},setup(e,o){const a=$(),n=$({reference:"",providerReference:"",sellPrice:0,name:""});F(()=>e.modelValue,d=>{n.value.reference=(d==null?void 0:d.reference)||"",n.value.providerReference=(d==null?void 0:d.providerReference)||"",n.value.name=(d==null?void 0:d.name)||"",n.value.sellPrice=(d==null?void 0:d.sellPrice)||0});const i=E(),m=h(),t=()=>{var d;n.value.reference="",n.value.providerReference="",n.value.sellPrice=0,n.value.name="",(d=a.value)==null||d.resetValidation()};return{form:a,formFields:n,onSubmit:async()=>{var d;try{const u={quantity:0,storeId:m.currentStore,lastChangeUserId:(d=m.userData)==null?void 0:d.uid,...n.value},U=await i.addProduct(u);t(),o.emit("update:modelValue",U)}catch(u){o.emit("product-creation-failed",u)}}}}}),de={class:"row justify-center"};function ne(e,o,a,n,i,m){const t=P("side-panel");return v(),k(t,{title:e.$t("product.newProduct"),onClose:o[4]||(o[4]=l=>e.$emit("close"))},{default:s(()=>[r(T,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:s(()=>[r(p,{filled:"",modelValue:e.formFields.reference,"onUpdate:modelValue":o[0]||(o[0]=l=>e.formFields.reference=l),label:e.$t("product.reference"),"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),r(p,{filled:"",modelValue:e.formFields.providerReference,"onUpdate:modelValue":o[1]||(o[1]=l=>e.formFields.providerReference=l),label:e.$t("product.providerReference")},null,8,["modelValue","label"]),r(p,{filled:"",modelValue:e.formFields.name,"onUpdate:modelValue":o[2]||(o[2]=l=>e.formFields.name=l),label:e.$t("product.name"),"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),r(p,{filled:"",suffix:"\u20AC",mask:"#.##","fill-mask":"0","reverse-fill-mask":"",modelValue:e.formFields.sellPrice,"onUpdate:modelValue":o[3]||(o[3]=l=>e.formFields.sellPrice=l),"input-class":"text-right",label:e.$t("product.sellPrice"),"lazy-rules":"",rules:[l=>l!==null&&l!==""&&l>0||e.$t("product.enterValidSellPrice")]},null,8,["modelValue","label","rules"]),b("div",de,[r(y,{label:e.$t("buttons.create"),type:"submit",color:"primary"},null,8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var ae=R(te,[["render",ne]]);const ie=g({name:"ProductEdit",props:{readonlyMode:{type:Boolean,default:!1},modelValue:{type:Object,required:!0}},emits:["close","update:modelValue","update:readonlyMode","product-edit-failed"],components:{SidePanel:q},setup(e,o){const a=w(()=>e.modelValue),n=D(e.readonlyMode);O(()=>n.value=e.readonlyMode);const i=E(),m=h();return{editing:a,isReadonly:n,onSubmit:async()=>{var l;try{a.value.lastChangeUserId=(l=m.userData)==null?void 0:l.uid,await i.editProduct(a.value),o.emit("update:modelValue",a.value)}catch(d){o.emit("product-edit-failed",d)}}}}}),se={class:"row"},ue={class:"row justify-center"};function me(e,o,a,n,i,m){const t=P("side-panel");return v(),k(t,{title:e.$t("product.detail"),onClose:o[5]||(o[5]=l=>e.$emit("close"))},{default:s(()=>[b("div",se,[r(A,{class:"","model-value":e.isReadonly,color:"green",label:e.$t("forms.editMode"),"true-value":!1,"false-value":!0,"onUpdate:modelValue":o[0]||(o[0]=l=>e.$emit("update:readonlyMode",e.isReadonly))},null,8,["model-value","label"])]),r(T,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:s(()=>[r(p,{filled:"","data-testid":"referenceinput",modelValue:e.editing.reference,"onUpdate:modelValue":o[1]||(o[1]=l=>e.editing.reference=l),label:e.$t("product.reference"),readonly:"","lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),r(p,{filled:"","data-testid":"providerrefinput",modelValue:e.editing.providerReference,"onUpdate:modelValue":o[2]||(o[2]=l=>e.editing.providerReference=l),readonly:e.isReadonly,label:e.$t("product.providerReference")},null,8,["modelValue","readonly","label"]),r(p,{filled:"","data-testid":"nameinput",modelValue:e.editing.name,"onUpdate:modelValue":o[3]||(o[3]=l=>e.editing.name=l),label:e.$t("product.name"),readonly:e.isReadonly,"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","readonly","rules"]),r(p,{filled:"",suffix:"\u20AC",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","data-testid":"sellpriceinput",modelValue:e.editing.sellPrice,"onUpdate:modelValue":o[4]||(o[4]=l=>e.editing.sellPrice=l),"input-class":"text-right",label:e.$t("product.sellPrice"),readonly:e.isReadonly,"lazy-rules":"",rules:[l=>l!==null&&l!==""&&l>0||e.$t("product.enterValidSellPrice")]},null,8,["modelValue","label","readonly","rules"]),b("div",ue,[e.isReadonly?G("",!0):(v(),k(y,{key:0,"data-testid":"modifybtn",label:e.$t("buttons.edit"),type:"submit",color:"primary"},null,8,["label"]))])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var ce=R(ie,[["render",me]]);function pe(e){return e.errorType===W.Technical?(console.log(e),V("common.technicalError")):(e==null?void 0:e.messageKey)===X.ReferenceExists?V("product.referenceExists"):V("common.technicalError")}const fe=g({name:"ProductsPage",components:{ProductGrid:re,ProductCreation:ae,ProductEdit:ce},setup(){const{t:e}=N(),o=Y(),a={id:"",name:"",quantity:0,sellPrice:0,reference:"",storeId:"",providerReference:"",lastChangeUserId:""},n=$(a);var i=$(null);const m=(c,f)=>{i.value=c;let z=Object.create(f);n.value=z},t=()=>{i.value=null,n.value=a},l=c=>{let f=Object.create(a);f.reference=c.reference,f.providerReference=c.providerReference,f.name=c.name,f.sellPrice=c.sellPrice,m("new",f)},d=w(()=>i.value==="detail");return{handleTechnicalError:c=>o.NotifyError(pe(c)),handleNewProduct:()=>{o.NotifySuccess(e("product.created")),t()},handleProductEdited:()=>{o.NotifySuccess(e("product.edited")),t()},sidePanel:i,openSidePanel:m,closeSidePanel:t,emptyRow:a,editingRow:n,readonlyEditMode:d,handleEditModeChanged:c=>{i.value=c?"edit":"detail"},duplicateProduct:l}}});function ye(e,o,a,n,i,m){const t=P("product-grid"),l=P("product-creation"),d=P("product-edit");return v(),M(K,null,[r(I,null,{default:s(()=>[r(t,{onNewProductClick:o[0]||(o[0]=u=>e.openSidePanel("new",e.emptyRow)),onEditRowClick:o[1]||(o[1]=u=>e.openSidePanel("edit",u)),onDetailRowClick:o[2]||(o[2]=u=>e.openSidePanel("detail",u)),onDuplicateRowClick:o[3]||(o[3]=u=>e.duplicateProduct(u))})]),_:1}),r(Q,{"model-value":e.sidePanel==="new",side:"right",bordered:""},{default:s(()=>[r(l,{modelValue:e.editingRow,"onUpdate:modelValue":[o[4]||(o[4]=u=>e.editingRow=u),e.handleNewProduct],onProductCreationFailed:e.handleTechnicalError,onClose:e.closeSidePanel},null,8,["modelValue","onUpdate:modelValue","onProductCreationFailed","onClose"])]),_:1},8,["model-value"]),r(Q,{"model-value":e.sidePanel==="edit"||e.sidePanel==="detail",side:"right",bordered:""},{default:s(()=>[r(d,{modelValue:e.editingRow,"onUpdate:modelValue":[o[5]||(o[5]=u=>e.editingRow=u),e.handleProductEdited],"readonly-mode":e.readonlyEditMode,onClose:e.closeSidePanel,"onUpdate:readonlyMode":e.handleEditModeChanged,onProductEditFailed:e.handleTechnicalError},null,8,["modelValue","readonly-mode","onClose","onUpdate:modelValue","onUpdate:readonlyMode","onProductEditFailed"])]),_:1},8,["model-value"])],64)}var Ue=R(fe,[["render",ye]]);export{Ue as default};
