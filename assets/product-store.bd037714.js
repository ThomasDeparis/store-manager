import{ai as p}from"./index.3db6d354.js";import{E as c}from"./errortype.ca0a8788.js";import{c as a,q as d,w as i,g as l,d as u,a as n,s as h,b as y}from"./user-store.7c7798a7.js";var f=(e=>(e[e.ReferenceExists=0]="ReferenceExists",e))(f||{});const P=p("product",{state:()=>({products:[],error:null,isLoading:!1}),actions:{async loadProducts(e){this.isLoading=!0;const t=a(n,"products"),r=d(t,i("storeId","==",e)),o=await l(r);this.products=o.docs.map(function(s){return{id:s.id,name:s.data().name,quantity:s.data().quantity,sellPrice:s.data().sellPrice,reference:s.data().reference,providerReference:s.data().providerReference,storeId:s.data().storeId,lastChangeUserId:s.data().lastChangeUserId}}),this.isLoading=!1},async referenceExists(e,t){const r=a(n,"products"),o=d(r,i("storeId","==",e),i("reference","==",t));return!(await l(o)).empty},async addProduct(e){if(await this.referenceExists(e.storeId,e.reference))throw{messageKey:f.ReferenceExists,productReference:e.reference,errorType:c.Business};try{const r=u(a(n,"products"));e.id=r.id,await h(r,e),this.products.push(e)}catch(r){throw{productReference:e.reference,errorType:c.Technical,message:r.toString()}}},async editProduct(e){try{const t=u(a(n,"products"),e.id);await y(t,{name:e.name,providerReference:e.providerReference,sellPrice:e.sellPrice,lastChangeUserId:e.lastChangeUserId});const r=this.products.findIndex(s=>s.id===e.id&&s.storeId===e.storeId);if(r<0)throw{productReference:e.reference,errorType:c.Technical,message:"productStore.editProduct : cannot find product in store to edit it"};console.log(e),console.log(e.sellPrice);const o=this.products[r];o.name=e.name,o.providerReference=e.providerReference,o.sellPrice=e.sellPrice,o.lastChangeUserId=e.lastChangeUserId}catch(t){throw{productReference:e.reference,errorType:c.Technical,message:t.toString()}}}}});export{f as P,P as u};
