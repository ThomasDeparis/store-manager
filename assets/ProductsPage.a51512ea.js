import{Q as F}from"./QPage.5dd8d1ba.js";import{Q}from"./QDrawer.4f00e929.js";import{d as V,w as j,o as B,c as h,r as p,_ as w,H as v,R as M,j as t,J as a,O as b,aj as c,Q as D,P as $,M as S,G as P,I as k,ak as A,al as G,am as K,K as O,F as H}from"./index.a67e16d6.js";import{Q as J,a as C,S as q}from"./SidePanel.597005d4.js";import{Q as L,a as W,E as X}from"./errortype.2d53c16c.js";import{u as E,P as Y}from"./product-store.f4a83591.js";import{u as U}from"./user-store.6a781c55.js";import{u as N}from"./vue-i18n.runtime.cb4582af.js";import{Q as T,u as Z}from"./notify-handler.1375f62c.js";import{t as R}from"./index.b5ffbbc2.js";import"./QItem.da979a34.js";const _=V({name:"ProductGrid",emits:["new-product-click","edit-row-click","detail-row-click"],setup(){const{t:e}=N(),o=E(),d=U(),s=[{name:"actions",label:"",align:"center"},{name:"reference",label:e("product.reference"),field:"reference",sortable:!0},{name:"providerreference",label:e("product.providerRef"),field:"providerReference",sortable:!0},{name:"name",label:e("product.name"),field:"name",sortable:!0},{name:"quantity",label:e("product.quantity"),field:"quantity",sortable:!0},{name:"sellprice",label:e("product.sellPrice"),field:"sellPrice",format:r=>`${r} \u20AC`}],n=()=>{o.loadProducts(d.currentStore)};j(()=>d.currentStore,()=>{n()}),B(()=>{d.currentStore!=null&&n()});const i=h(()=>o.products.map(function(r){return{...r,actions:null}}));return{filter:p(""),columns:s,rows:i,loadProducts:n,loading:o.isLoading}}}),x={class:"q-pa-md"},ee={class:"text-body2"},oe={class:"text-body2"},le={class:"text-body2"};function te(e,o,d,s,n,i){return v(),M("div",x,[t(W,{class:"body--light","grid-header":"",bordered:"",rows:e.rows,columns:e.columns,"row-key":"reference",filter:e.filter,"rows-per-page-options":[50,100]},{top:a(()=>[t(b,{"data-testid":"newproductbtn",color:"primary",label:e.$t("product.newProduct"),onClick:o[0]||(o[0]=r=>e.$emit("new-product-click"))},null,8,["label"]),t(J),t(c,{"data-testid":"searchproductinput",dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=r=>e.filter=r)},{append:a(()=>[t(D,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":a(r=>[t(L,{props:r},{default:a(()=>[t(b,{"data-testid":"editproductbtn",class:"q-mr-sm",icon:"edit",push:"",round:"",color:"amber-7",size:"sm",onClick:l=>e.$emit("edit-row-click",r.row)},{default:a(()=>[t(C,null,{default:a(()=>[$("div",ee,S(e.$t("buttons.edit")),1)]),_:1})]),_:2},1032,["onClick"]),t(b,{"data-testid":"detailproductbtn",icon:"visibility",class:"q-mr-sm",push:"",round:"",color:"primary",size:"sm",onClick:l=>e.$emit("detail-row-click",r.row)},{default:a(()=>[t(C,null,{default:a(()=>[$("div",oe,S(e.$t("buttons.detail")),1)]),_:1})]),_:2},1032,["onClick"]),t(b,{icon:"copy_all",round:"",push:"",color:"grey",size:"sm"},{default:a(()=>[t(C,null,{default:a(()=>[$("div",le,S(e.$t("buttons.duplicate")),1)]),_:1})]),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])])}var re=w(_,[["render",te]]);const de=V({name:"ProductCreation",emits:["close","product-created","product-creation-failed"],components:{SidePanel:q},setup(e,o){const d=p(),s=p(""),n=p(""),i=p(0),r=p(""),l=E(),f=U(),u=()=>{var y;s.value="",n.value="",i.value=0,r.value="",(y=d.value)==null||y.resetValidation()};return{form:d,reference:s,providerReference:n,sellPrice:i,name:r,onSubmit:async()=>{var y;try{const m={reference:s.value,providerReference:n.value,sellPrice:i.value,name:r.value,quantity:0,storeId:f.currentStore,lastChangeUserId:(y=f.userData)==null?void 0:y.uid},g=await l.addProduct(m);o.emit("product-created",g),u()}catch(m){o.emit("product-creation-failed",m)}}}}}),ne={class:"row justify-center"};function ae(e,o,d,s,n,i){const r=P("side-panel");return v(),k(r,{title:e.$t("product.newProduct"),onClose:o[4]||(o[4]=l=>e.$emit("close"))},{default:a(()=>[t(T,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:a(()=>[t(c,{filled:"",modelValue:e.reference,"onUpdate:modelValue":o[0]||(o[0]=l=>e.reference=l),label:e.$t("product.reference"),"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),t(c,{filled:"",modelValue:e.providerReference,"onUpdate:modelValue":o[1]||(o[1]=l=>e.providerReference=l),label:e.$t("product.providerReference")},null,8,["modelValue","label"]),t(c,{filled:"",modelValue:e.name,"onUpdate:modelValue":o[2]||(o[2]=l=>e.name=l),label:e.$t("product.name"),"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),t(c,{filled:"",suffix:"\u20AC",mask:"#.##","fill-mask":"0","reverse-fill-mask":"",modelValue:e.sellPrice,"onUpdate:modelValue":o[3]||(o[3]=l=>e.sellPrice=l),"input-class":"text-right",label:e.$t("product.sellPrice"),"lazy-rules":"",rules:[l=>l!==null&&l!==""&&l>0||e.$t("product.enterValidSellPrice")]},null,8,["modelValue","label","rules"]),$("div",ne,[t(b,{label:e.$t("buttons.create"),type:"submit",color:"primary"},null,8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var se=w(de,[["render",ae]]);const ie=V({name:"ProductEdit",props:{readonlyMode:{type:Boolean,default:!1},modelValue:{type:Object,required:!0}},emits:["close","update:modelValue","update:readonlyMode","product-edit-failed"],components:{SidePanel:q},setup(e,o){const d=h(()=>e.modelValue),s=A(e.readonlyMode);G(()=>s.value=e.readonlyMode);const n=E(),i=U();return{editing:d,isReadonly:s,onSubmit:async()=>{var l;try{d.value.lastChangeUserId=(l=i.userData)==null?void 0:l.uid,await n.editProduct(d.value),o.emit("update:modelValue",d.value)}catch(f){o.emit("product-edit-failed",f)}}}}}),ue={class:"row"},me={class:"row justify-center"};function ce(e,o,d,s,n,i){const r=P("side-panel");return v(),k(r,{title:e.$t("product.detail"),onClose:o[5]||(o[5]=l=>e.$emit("close"))},{default:a(()=>[$("div",ue,[t(K,{class:"","model-value":e.isReadonly,color:"green",label:e.$t("forms.editMode"),"true-value":!1,"false-value":!0,"onUpdate:modelValue":o[0]||(o[0]=l=>e.$emit("update:readonlyMode",e.isReadonly))},null,8,["model-value","label"])]),t(T,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:a(()=>[t(c,{filled:"","data-testid":"referenceinput",modelValue:e.editing.reference,"onUpdate:modelValue":o[1]||(o[1]=l=>e.editing.reference=l),label:e.$t("product.reference"),readonly:"","lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),t(c,{filled:"","data-testid":"providerrefinput",modelValue:e.editing.providerReference,"onUpdate:modelValue":o[2]||(o[2]=l=>e.editing.providerReference=l),readonly:e.isReadonly,label:e.$t("product.providerReference")},null,8,["modelValue","readonly","label"]),t(c,{filled:"","data-testid":"nameinput",modelValue:e.editing.name,"onUpdate:modelValue":o[3]||(o[3]=l=>e.editing.name=l),label:e.$t("product.name"),readonly:e.isReadonly,"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","readonly","rules"]),t(c,{filled:"",suffix:"\u20AC",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","data-testid":"sellpriceinput",modelValue:e.editing.sellPrice,"onUpdate:modelValue":o[4]||(o[4]=l=>e.editing.sellPrice=l),"input-class":"text-right",label:e.$t("product.sellPrice"),readonly:e.isReadonly,"lazy-rules":"",rules:[l=>l!==null&&l!==""&&l>0||e.$t("product.enterValidSellPrice")]},null,8,["modelValue","label","readonly","rules"]),$("div",me,[e.isReadonly?O("",!0):(v(),k(b,{key:0,"data-testid":"modifybtn",label:e.$t("buttons.edit"),type:"submit",color:"primary"},null,8,["label"]))])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var pe=w(ie,[["render",ce]]);function fe(e){return e.errorType===X.Technical?(console.log(e),R("common.technicalError")):(e==null?void 0:e.messageKey)===Y.ReferenceExists?R("product.referenceExists"):R("common.technicalError")}const ye=V({name:"ProductsPage",components:{ProductGrid:re,ProductCreation:se,ProductEdit:pe},setup(){const{t:e}=N(),o=Z(),d={id:"",name:"",quantity:0,sellPrice:0,reference:"",storeId:"",providerReference:"",lastChangeUserId:""},s=p(d);var n=p(null);const i=(m,g)=>{n.value=m;let I=Object.create(g);s.value=I},r=()=>{n.value=null,s.value=d},l=h(()=>n.value==="detail");return{handleTechnicalError:m=>o.NotifyError(fe(m)),handleNewProduct:()=>{o.NotifySuccess(e("product.created"))},handleProductEdited:()=>{o.NotifySuccess(e("product.edited")),r()},sidePanel:n,openSidePanel:i,closeSidePanel:r,emptyRow:d,editingRow:s,readonlyEditMode:l,handleEditModeChanged:m=>{n.value=m?"edit":"detail"}}}});function be(e,o,d,s,n,i){const r=P("product-grid"),l=P("product-creation"),f=P("product-edit");return v(),M(H,null,[t(F,null,{default:a(()=>[t(r,{onNewProductClick:o[0]||(o[0]=u=>e.openSidePanel("new",e.emptyRow)),onEditRowClick:o[1]||(o[1]=u=>e.openSidePanel("edit",u)),onDetailRowClick:o[2]||(o[2]=u=>e.openSidePanel("detail",u))})]),_:1}),t(Q,{"model-value":e.sidePanel==="new",side:"right",bordered:""},{default:a(()=>[t(l,{onProductCreated:e.handleNewProduct,onProductCreationFailed:e.handleTechnicalError,onClose:e.closeSidePanel},null,8,["onProductCreated","onProductCreationFailed","onClose"])]),_:1},8,["model-value"]),t(Q,{"model-value":e.sidePanel==="edit"||e.sidePanel==="detail",side:"right",bordered:""},{default:a(()=>[t(f,{modelValue:e.editingRow,"onUpdate:modelValue":[o[3]||(o[3]=u=>e.editingRow=u),e.handleProductEdited],"readonly-mode":e.readonlyEditMode,onClose:e.closeSidePanel,"onUpdate:readonlyMode":e.handleEditModeChanged,onProductEditFailed:e.handleTechnicalError},null,8,["modelValue","readonly-mode","onClose","onUpdate:modelValue","onUpdate:readonlyMode","onProductEditFailed"])]),_:1},8,["model-value"])],64)}var Ee=w(ye,[["render",be]]);export{Ee as default};
