import{Q as T}from"./QPage.7f4d9088.js";import{Q as N}from"./QDrawer.317d8aed.js";import{d as h,c as P,r as m,_ as C,H as g,R as M,j as l,J as t,O as f,aj as b,Q as B,P as y,M as V,G as $,I as S,ak as z,al as G,am as H,K,g as J,N as L,F as A}from"./index.60a11d20.js";import{Q as W,a as k,S as O}from"./SidePanel.8f4525e5.js";import{Q as X,a as Y}from"./errortype.bf730c74.js";import{u as E}from"./provider-store.1c7f367c.js";import{u as R}from"./user-store.3d0bea97.js";import{u as I}from"./vue-i18n.runtime.c1b4cf47.js";import{Q as j}from"./QForm.f24bdaed.js";import{t as Z}from"./index.9f29fa3b.js";import{u as _}from"./notify-handler.fa1bfc49.js";import"./QItem.ca99be11.js";const x=h({name:"ProviderGrid",emits:["new-provider-click","edit-row-click","detail-row-click","order-row-click"],setup(){const{t:e}=I(),o=E(),d=R(),s=[{name:"actions",label:"",align:"center"},{name:"name",label:e("provider.name"),field:"name",sortable:!0},{name:"phone",label:e("provider.phone"),field:"phone"},{name:"email",label:e("provider.email"),field:"email",sortable:!0}],a=()=>{o.loadProviders(d.currentStore)},i=P(()=>o.providers.map(function(n){return{...n,actions:null}}));return{filter:m(""),columns:s,rows:i,loadProviders:a,loading:P(()=>o.isLoading)}}}),ee={class:"q-pa-md"},oe={class:"text-body2"},re={class:"text-body2"},le={class:"text-body2"};function ne(e,o,d,s,a,i){return g(),M("div",ee,[l(Y,{"grid-header":"",bordered:"",rows:e.rows,columns:e.columns,"row-key":"reference",filter:e.filter,"rows-per-page-options":[50,100]},{top:t(()=>[l(f,{color:"primary",label:e.$t("provider.newProvider"),onClick:o[0]||(o[0]=n=>e.$emit("new-provider-click"))},null,8,["label"]),l(W),l(b,{dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=n=>e.filter=n)},{append:t(()=>[l(B,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":t(n=>[l(X,{props:n},{default:t(()=>[l(f,{class:"q-mr-sm",icon:"edit",push:"",round:"",color:"amber-7",size:"sm",onClick:r=>e.$emit("edit-row-click",n.row)},{default:t(()=>[l(k,null,{default:t(()=>[y("div",oe,V(e.$t("buttons.edit")),1)]),_:1})]),_:2},1032,["onClick"]),l(f,{icon:"visibility",class:"q-mr-sm",push:"",round:"",color:"primary",size:"sm",onClick:r=>e.$emit("detail-row-click",n.row)},{default:t(()=>[l(k,null,{default:t(()=>[y("div",re,V(e.$t("buttons.detail")),1)]),_:1})]),_:2},1032,["onClick"]),l(f,{icon:"shopping_cart",class:"q-mr-sm",push:"",round:"",color:"green",size:"sm",onClick:r=>e.$emit("order-row-click",n.row)},{default:t(()=>[l(k,null,{default:t(()=>[y("div",le,V(e.$t("buttons.order")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),l(f,{icon:"search",onClick:e.loadProviders},null,8,["onClick"])])}var de=C(x,[["render",ne]]);const ae=h({name:"ProviderCreation",emits:["close","provider-created","provider-creation-failed"],components:{SidePanel:O},setup(e,o){const d=m(),s=m(""),a=m(""),i=m(""),n=E(),r=R(),v=()=>{var c;s.value="",a.value="",i.value="",(c=d.value)==null||c.resetValidation()};return{form:d,email:s,phone:a,name:i,onSubmit:async()=>{var c;try{const w={email:s.value,phone:a.value,name:i.value,storeId:r.currentStore,lastChangeUserId:(c=r.userData)==null?void 0:c.uid},U=await n.addProvider(w);o.emit("provider-created",U),v()}catch(w){o.emit("provider-creation-failed",w)}}}}}),ie={class:"row justify-center"};function te(e,o,d,s,a,i){const n=$("side-panel");return g(),S(n,{title:e.$t("provider.newProvider"),onClose:o[3]||(o[3]=r=>e.$emit("close"))},{default:t(()=>[l(j,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:t(()=>[l(b,{filled:"",modelValue:e.email,"onUpdate:modelValue":o[0]||(o[0]=r=>e.email=r),label:e.$t("provider.email")},null,8,["modelValue","label"]),l(b,{filled:"",modelValue:e.name,"onUpdate:modelValue":o[1]||(o[1]=r=>e.name=r),label:e.$t("provider.name"),"lazy-rules":"",rules:[r=>r&&r.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),l(b,{filled:"",prefix:"+33",mask:"# ## ## ## ##","reverse-fill-mask":"",modelValue:e.phone,"onUpdate:modelValue":o[2]||(o[2]=r=>e.phone=r),label:e.$t("provider.phone")},null,8,["modelValue","label"]),y("div",ie,[l(f,{label:e.$t("buttons.create"),type:"submit",color:"primary"},null,8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var se=C(ae,[["render",te]]);const ue=h({name:"ProviderEdit",props:{readonlyMode:{type:Boolean,default:!1},modelValue:{type:Object,required:!0}},emits:["close","update:modelValue","update:readonlyMode","provider-edit-failed"],components:{SidePanel:O},setup(e,o){const d=P(()=>e.modelValue),s=z(e.readonlyMode);G(()=>s.value=e.readonlyMode);const a=E(),i=R();return{editing:d,isReadonly:s,onSubmit:async()=>{var r;try{d.value.lastChangeUserId=(r=i.userData)==null?void 0:r.uid,await a.editProvider(d.value),o.emit("update:modelValue",d.value)}catch(v){o.emit("provider-edit-failed",v)}}}}}),me={class:"row"},pe={class:"row justify-center"};function ve(e,o,d,s,a,i){const n=$("side-panel");return g(),S(n,{title:e.$t("provider.detail"),onClose:o[4]||(o[4]=r=>e.$emit("close"))},{default:t(()=>[y("div",me,[l(H,{class:"","model-value":e.isReadonly,color:"green",label:e.$t("forms.editMode"),"true-value":!1,"false-value":!0,"onUpdate:modelValue":o[0]||(o[0]=r=>e.$emit("update:readonlyMode",e.isReadonly))},null,8,["model-value","label"])]),l(j,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:t(()=>[l(b,{filled:"",modelValue:e.editing.email,"onUpdate:modelValue":o[1]||(o[1]=r=>e.editing.email=r),readonly:e.isReadonly,label:e.$t("provider.email")},null,8,["modelValue","readonly","label"]),l(b,{filled:"",modelValue:e.editing.name,"onUpdate:modelValue":o[2]||(o[2]=r=>e.editing.name=r),label:e.$t("provider.name"),readonly:e.isReadonly,"lazy-rules":"",rules:[r=>r&&r.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","readonly","rules"]),l(b,{filled:"",prefix:"+33",mask:"# ## ## ## ##","reverse-fill-mask":"",modelValue:e.editing.phone,"onUpdate:modelValue":o[3]||(o[3]=r=>e.editing.phone=r),label:e.$t("provider.phone"),readonly:e.isReadonly},null,8,["modelValue","label","readonly"]),y("div",pe,[e.isReadonly?K("",!0):(g(),S(f,{key:0,label:e.$t("buttons.edit"),type:"submit",color:"primary"},null,8,["label"]))])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var ce=C(ue,[["render",ve]]);function fe(e){return console.log(e),Z("common.technicalError")}const be=()=>!0;function ye(e){const o={};return e.forEach(d=>{o[d]=be}),o}function Q(){const{emit:e,proxy:o}=J(),d=m(null);function s(){d.value.show()}function a(){d.value.hide()}function i(r){e("ok",r),a()}function n(){e("hide")}return Object.assign(o,{show:s,hide:a}),{dialogRef:d,onDialogHide:n,onDialogOK:i,onDialogCancel:a}}const q=["ok","hide"];Q.emits=q;Q.emitsObject=ye(q);const $e=h({name:"ProvidersPage",components:{ProviderGrid:de,ProviderCreation:se,ProviderEdit:ce},emits:[...Q.emits],setup(){const{t:e}=I(),o=L(),d=_(),s=m(!1),a=m(),i={id:"",name:"",storeId:"",lastChangeUserId:"",email:"",phone:""},n=m(i);var r=m(null);const v=(p,D)=>{r.value=p;let F=Object.create(D);n.value=F},u=()=>{r.value=null,n.value=i},c=P(()=>r.value==="detail");return{handleTechnicalError:p=>d.NotifyError(fe(p)),handleNewProvider:()=>{d.NotifySuccess(e("provider.created"))},handleProviderEdited:()=>{d.NotifySuccess(e("provider.edited")),u()},sidePanel:r,openSidePanel:v,closeSidePanel:u,emptyRow:i,editingRow:n,readonlyEditMode:c,handleEditModeChanged:p=>{console.log("nouveau mode"),console.log(p),r.value=p?"edit":"detail"},dialogOpened:s,selectedProvider:a,openNewOrder:p=>{o.push({name:"provider-neworder",params:{providerId:p.id}})}}}});function ge(e,o,d,s,a,i){const n=$("provider-grid"),r=$("provider-creation"),v=$("provider-edit");return g(),M(A,null,[l(T,null,{default:t(()=>[l(n,{onNewProviderClick:o[0]||(o[0]=u=>e.openSidePanel("new",e.emptyRow)),onEditRowClick:o[1]||(o[1]=u=>e.openSidePanel("edit",u)),onDetailRowClick:o[2]||(o[2]=u=>e.openSidePanel("detail",u)),onOrderRowClick:o[3]||(o[3]=u=>e.openNewOrder(u))})]),_:1}),l(N,{"model-value":e.sidePanel==="new",side:"right",bordered:""},{default:t(()=>[l(r,{onProviderCreated:e.handleNewProvider,onProviderCreationFailed:e.handleTechnicalError,onClose:e.closeSidePanel},null,8,["onProviderCreated","onProviderCreationFailed","onClose"])]),_:1},8,["model-value"]),l(N,{"model-value":e.sidePanel==="edit"||e.sidePanel==="detail",side:"right",bordered:""},{default:t(()=>[l(v,{modelValue:e.editingRow,"onUpdate:modelValue":[o[4]||(o[4]=u=>e.editingRow=u),e.handleProviderEdited],"readonly-mode":e.readonlyEditMode,onClose:e.closeSidePanel,"onUpdate:readonlyMode":e.handleEditModeChanged,onProviderEditFailed:e.handleTechnicalError},null,8,["modelValue","readonly-mode","onClose","onUpdate:modelValue","onUpdate:readonlyMode","onProviderEditFailed"])]),_:1},8,["model-value"])],64)}var je=C($e,[["render",ge]]);export{je as default};
