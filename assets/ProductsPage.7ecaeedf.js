import{Q as j}from"./QPage.3c81ed27.js";import{Q}from"./QDrawer.1509bc82.js";import{d as g,w as F,o as z,c as k,r as v,_ as R,H as $,R as M,j as r,J as s,O as y,aj as p,Q as B,P as b,M as S,G as P,I as w,ak as D,al as O,am as G,K,F as A}from"./index.34f6b76d.js";import{Q as H,a as C,S as q}from"./SidePanel.c0f5721f.js";import{Q as J,a as L,E as W}from"./errortype.0d786a7e.js";import{u as E,P as X}from"./product-store.7e0ce431.js";import{u as U}from"./user-store.bf6ba600.js";import{u as N}from"./vue-i18n.runtime.6f8009de.js";import{Q as T,u as Y}from"./notify-handler.5eed9870.js";import{P as Z}from"./PriceInput.f4869786.js";import{t as V}from"./index.622f8df3.js";import"./QItem.78468a73.js";const _=g({name:"ProductGrid",emits:["new-product-click","edit-row-click","detail-row-click","duplicate-row-click"],setup(){const{t:e}=N(),o=E(),a=U(),n=[{name:"actions",label:"",align:"center"},{name:"reference",label:e("product.reference"),field:"reference",sortable:!0},{name:"providerreference",label:e("product.providerRef"),field:"providerReference",sortable:!0},{name:"name",label:e("product.name"),field:"name",sortable:!0},{name:"quantity",label:e("product.quantity"),field:"quantity",sortable:!0},{name:"sellprice",label:e("product.sellPrice"),field:"sellPrice",format:d=>`${d} \u20AC`}],i=()=>{o.loadProducts(a.currentStore)};F(()=>a.currentStore,()=>{i()}),z(()=>{a.currentStore!=null&&i()});const m=k(()=>o.products.map(function(d){return{...d,actions:null}}));return{filter:v(""),columns:n,rows:m,loadProducts:i,loading:o.isLoading}}}),x={class:"q-pa-md"},ee={class:"text-body2"},oe={class:"text-body2"},le={class:"text-body2"};function te(e,o,a,n,i,m){return $(),M("div",x,[r(L,{class:"body--light","grid-header":"",bordered:"",rows:e.rows,columns:e.columns,"row-key":"reference",filter:e.filter,"rows-per-page-options":[50,100]},{top:s(()=>[r(y,{"data-testid":"newproductbtn",color:"primary",label:e.$t("product.newProduct"),onClick:o[0]||(o[0]=d=>e.$emit("new-product-click"))},null,8,["label"]),r(H),r(p,{"data-testid":"searchproductinput",dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=d=>e.filter=d)},{append:s(()=>[r(B,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":s(d=>[r(J,{props:d},{default:s(()=>[r(y,{"data-testid":"editproductbtn",class:"q-mr-sm",icon:"edit",push:"",round:"",color:"amber-7",size:"sm",onClick:t=>e.$emit("edit-row-click",d.row)},{default:s(()=>[r(C,null,{default:s(()=>[b("div",ee,S(e.$t("buttons.edit")),1)]),_:1})]),_:2},1032,["onClick"]),r(y,{"data-testid":"detailproductbtn",icon:"visibility",class:"q-mr-sm",push:"",round:"",color:"primary",size:"sm",onClick:t=>e.$emit("detail-row-click",d.row)},{default:s(()=>[r(C,null,{default:s(()=>[b("div",oe,S(e.$t("buttons.detail")),1)]),_:1})]),_:2},1032,["onClick"]),r(y,{"data-testid":"duplicateproductbtn",icon:"copy_all",round:"",push:"",color:"grey",size:"sm",onClick:t=>e.$emit("duplicate-row-click",d.row)},{default:s(()=>[r(C,null,{default:s(()=>[b("div",le,S(e.$t("buttons.duplicate")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])])}var re=R(_,[["render",te]]);const de=g({name:"ProductCreation",props:{modelValue:{type:Object,required:!1}},emits:["close","update:modelValue","product-creation-failed"],components:{SidePanel:q,PriceInput:Z},setup(e,o){const a=v(),n=v({reference:"",providerReference:"",sellPrice:0,name:""});F(()=>e.modelValue,l=>{n.value.reference=(l==null?void 0:l.reference)||"",n.value.providerReference=(l==null?void 0:l.providerReference)||"",n.value.name=(l==null?void 0:l.name)||"",n.value.sellPrice=(l==null?void 0:l.sellPrice)||0});const i=E(),m=U(),d=()=>{var l;n.value.reference="",n.value.providerReference="",n.value.sellPrice=0,n.value.name="",(l=a.value)==null||l.resetValidation()};return{form:a,formFields:n,onSubmit:async()=>{var l;try{const u={quantity:0,storeId:m.currentStore,lastChangeUserId:(l=m.userData)==null?void 0:l.uid,...n.value},h=await i.addProduct(u);d(),o.emit("update:modelValue",h)}catch(u){o.emit("product-creation-failed",u)}}}}}),ne={class:"row justify-center"};function ae(e,o,a,n,i,m){const d=P("price-input"),t=P("side-panel");return $(),w(t,{title:e.$t("product.newProduct"),onClose:o[4]||(o[4]=l=>e.$emit("close"))},{default:s(()=>[r(T,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:s(()=>[r(p,{filled:"",modelValue:e.formFields.reference,"onUpdate:modelValue":o[0]||(o[0]=l=>e.formFields.reference=l),label:e.$t("product.reference"),"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),r(p,{filled:"",modelValue:e.formFields.providerReference,"onUpdate:modelValue":o[1]||(o[1]=l=>e.formFields.providerReference=l),label:e.$t("product.providerReference")},null,8,["modelValue","label"]),r(p,{filled:"",modelValue:e.formFields.name,"onUpdate:modelValue":o[2]||(o[2]=l=>e.formFields.name=l),label:e.$t("product.name"),"lazy-rules":"",rules:[l=>l&&l.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),r(d,{modelValue:e.formFields.sellPrice,"onUpdate:modelValue":o[3]||(o[3]=l=>e.formFields.sellPrice=l)},null,8,["modelValue"]),b("div",ne,[r(y,{label:e.$t("buttons.create"),type:"submit",color:"primary"},null,8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var ie=R(de,[["render",ae]]);const se=g({name:"ProductEdit",props:{readonlyMode:{type:Boolean,default:!1},modelValue:{type:Object,required:!0}},emits:["close","update:modelValue","update:readonlyMode","product-edit-failed"],components:{SidePanel:q},setup(e,o){const a=k(()=>e.modelValue),n=D(e.readonlyMode);O(()=>n.value=e.readonlyMode);const i=E(),m=U();return{editing:a,isReadonly:n,onSubmit:async()=>{var t;try{a.value.lastChangeUserId=(t=m.userData)==null?void 0:t.uid,await i.editProduct(a.value),o.emit("update:modelValue",a.value)}catch(l){o.emit("product-edit-failed",l)}}}}}),ue={class:"row"},me={class:"row justify-center"};function ce(e,o,a,n,i,m){const d=P("side-panel");return $(),w(d,{title:e.$t("product.detail"),onClose:o[5]||(o[5]=t=>e.$emit("close"))},{default:s(()=>[b("div",ue,[r(G,{class:"","model-value":e.isReadonly,color:"green",label:e.$t("forms.editMode"),"true-value":!1,"false-value":!0,"onUpdate:modelValue":o[0]||(o[0]=t=>e.$emit("update:readonlyMode",e.isReadonly))},null,8,["model-value","label"])]),r(T,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:s(()=>[r(p,{filled:"","data-testid":"referenceinput",modelValue:e.editing.reference,"onUpdate:modelValue":o[1]||(o[1]=t=>e.editing.reference=t),label:e.$t("product.reference"),readonly:"","lazy-rules":"",rules:[t=>t&&t.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),r(p,{filled:"","data-testid":"providerrefinput",modelValue:e.editing.providerReference,"onUpdate:modelValue":o[2]||(o[2]=t=>e.editing.providerReference=t),readonly:e.isReadonly,label:e.$t("product.providerReference")},null,8,["modelValue","readonly","label"]),r(p,{filled:"","data-testid":"nameinput",modelValue:e.editing.name,"onUpdate:modelValue":o[3]||(o[3]=t=>e.editing.name=t),label:e.$t("product.name"),readonly:e.isReadonly,"lazy-rules":"",rules:[t=>t&&t.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","readonly","rules"]),r(p,{filled:"",suffix:"\u20AC",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","data-testid":"sellpriceinput",modelValue:e.editing.sellPrice,"onUpdate:modelValue":o[4]||(o[4]=t=>e.editing.sellPrice=t),"input-class":"text-right",label:e.$t("product.sellPrice"),readonly:e.isReadonly,"lazy-rules":"",rules:[t=>t!==null&&t!==""&&t>0||e.$t("product.enterValidSellPrice")]},null,8,["modelValue","label","readonly","rules"]),b("div",me,[e.isReadonly?K("",!0):($(),w(y,{key:0,"data-testid":"modifybtn",label:e.$t("buttons.edit"),type:"submit",color:"primary"},null,8,["label"]))])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var pe=R(se,[["render",ce]]);function fe(e){return e.errorType===W.Technical?(console.log(e),V("common.technicalError")):(e==null?void 0:e.messageKey)===X.ReferenceExists?V("product.referenceExists"):V("common.technicalError")}const ye=g({name:"ProductsPage",components:{ProductGrid:re,ProductCreation:ie,ProductEdit:pe},setup(){const{t:e}=N(),o=Y(),a={id:"",name:"",quantity:0,sellPrice:0,reference:"",storeId:"",providerReference:"",lastChangeUserId:""},n=v(a);var i=v(null);const m=(c,f)=>{i.value=c;let I=Object.create(f);n.value=I},d=()=>{i.value=null,n.value=a},t=c=>{let f=Object.create(a);f.reference=c.reference,f.providerReference=c.providerReference,f.name=c.name,f.sellPrice=c.sellPrice,m("new",f)},l=k(()=>i.value==="detail");return{handleTechnicalError:c=>o.NotifyError(fe(c)),handleNewProduct:()=>{o.NotifySuccess(e("product.created")),d()},handleProductEdited:()=>{o.NotifySuccess(e("product.edited")),d()},sidePanel:i,openSidePanel:m,closeSidePanel:d,emptyRow:a,editingRow:n,readonlyEditMode:l,handleEditModeChanged:c=>{i.value=c?"edit":"detail"},duplicateProduct:t}}});function be(e,o,a,n,i,m){const d=P("product-grid"),t=P("product-creation"),l=P("product-edit");return $(),M(A,null,[r(j,null,{default:s(()=>[r(d,{onNewProductClick:o[0]||(o[0]=u=>e.openSidePanel("new",e.emptyRow)),onEditRowClick:o[1]||(o[1]=u=>e.openSidePanel("edit",u)),onDetailRowClick:o[2]||(o[2]=u=>e.openSidePanel("detail",u)),onDuplicateRowClick:o[3]||(o[3]=u=>e.duplicateProduct(u))})]),_:1}),r(Q,{"model-value":e.sidePanel==="new",side:"right",bordered:""},{default:s(()=>[r(t,{modelValue:e.editingRow,"onUpdate:modelValue":[o[4]||(o[4]=u=>e.editingRow=u),e.handleNewProduct],onProductCreationFailed:e.handleTechnicalError,onClose:e.closeSidePanel},null,8,["modelValue","onUpdate:modelValue","onProductCreationFailed","onClose"])]),_:1},8,["model-value"]),r(Q,{"model-value":e.sidePanel==="edit"||e.sidePanel==="detail",side:"right",bordered:""},{default:s(()=>[r(l,{modelValue:e.editingRow,"onUpdate:modelValue":[o[5]||(o[5]=u=>e.editingRow=u),e.handleProductEdited],"readonly-mode":e.readonlyEditMode,onClose:e.closeSidePanel,"onUpdate:readonlyMode":e.handleEditModeChanged,onProductEditFailed:e.handleTechnicalError},null,8,["modelValue","readonly-mode","onClose","onUpdate:modelValue","onUpdate:readonlyMode","onProductEditFailed"])]),_:1},8,["model-value"])],64)}var Fe=R(ye,[["render",be]]);export{Fe as default};
