import{Q as P}from"./QPage.c5ade77a.js";import{Q as R}from"./QDrawer.d37ed123.js";import{d as v,c as O,w as D,o as N,r as b,_ as $,H as u,R as w,j as n,J as t,O as C,aj as _,Q as E,P as k,I as y,L as p,M as g,S as B,F as V,b2 as L,K as U,N as j,G as S}from"./index.3db6d354.js";import{Q as q,a as F}from"./QTooltip.1c55f155.js";import{Q as M,a as T}from"./errortype.ca0a8788.js";import{u as Y,h as G}from"./moment.e4517590.js";import{u as z}from"./user-store.7c7798a7.js";import{u as h}from"./vue-i18n.runtime.f032216e.js";import{a as Q,c as H,b as J,Q as K}from"./QItem.02ecd005.js";import{Q as A}from"./QForm.1abbfd2a.js";import{u as W}from"./use-dialog-plugin-component.d7ff1950.js";const X=v({name:"OrderGrid",emits:["new-order-click","confirm-row-click"],setup(){const{t:e}=h(),o=Y(),a=z(),s=[{name:"actions",label:"",align:"center"},{name:"reference",label:e("order.reference"),field:"reference",sortable:!0},{name:"provider",label:e("provider.name"),field:"providerId"},{name:"orderDate",label:e("order.orderDate"),field:"orderDate",sortable:!0,format:r=>G(r).format("DD/MM/YYYY")}],d=()=>{var r;(o.orders==null||((r=o.orders)==null?void 0:r.length)===0||o.storeId!==a.currentStore)&&o.loadOrders(a.currentStore)},l=O(()=>o.orders.map(function(r){return{...r,actions:null}}));return D(()=>a.currentStore,()=>{d()}),N(()=>{a.currentStore!=null&&d()}),{filter:b(""),columns:s,rows:l,loadOrders:d,loading:O(()=>o.isLoading)}}}),Z={class:"q-pa-md"},x=k("div",{class:"text-body2"},"Finaliser la commande",-1);function ee(e,o,a,s,d,l){return u(),w("div",Z,[n(T,{"grid-header":"",bordered:"",rows:e.rows,columns:e.columns,"row-key":"reference",filter:e.filter,"rows-per-page-options":[50,100]},{top:t(()=>[n(C,{color:"primary",label:e.$t("order.newOrder"),onClick:o[0]||(o[0]=r=>e.$emit("new-order-click"))},null,8,["label"]),n(q),n(_,{dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=r=>e.filter=r)},{append:t(()=>[n(E,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":t(r=>[n(M,{props:r},{default:t(()=>[n(C,{class:"q-mr-sm",icon:"check_circle",push:"",round:"",color:"green",size:"sm",onClick:c=>e.$emit("confirm-row-click",r.row)},{default:t(()=>[n(F,null,{default:t(()=>[x]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])])}var re=$(X,[["render",ee]]);const oe=v({name:"OrderConfirm",emits:["order-confirmed"],props:{orderReference:{type:String},modelValue:{type:Object}},setup(e,o){const a=()=>{console.log("commande valid\xE9e"),o.emit("order-confirmed",e.modelValue)};return{cartContent:O(()=>e.modelValue),confirmOrder:a}}});function ne(e,o,a,s,d,l){return u(),y(H,{bordered:"",padding:""},{default:t(()=>[n(Q,{header:""},{default:t(()=>[p(g(e.orderReference)+" : r\xE9ception de la commande ",1)]),_:1}),n(A,{onSubmit:e.confirmOrder},{default:t(()=>[n(C,{type:"submit"},{default:t(()=>[p("Confirmer r\xE9ception")]),_:1}),(u(!0),w(V,null,B(e.cartContent,(r,c)=>{var i;return u(),w("div",{key:r.productId},[n(J,null,{default:t(()=>[n(K,null,{default:t(()=>[n(Q,{overline:""},{default:t(()=>[p(g(r.productReference),1)]),_:2},1024),n(Q,null,{default:t(()=>[p(g(r.productName),1)]),_:2},1024),n(Q,{class:"row",caption:""},{default:t(()=>[k("p",null,"Quantit\xE9 command\xE9e : "+g(r.orderedQty),1),n(_,{class:"col-6 q-pa-sm",modelValue:r.receivedQty,"onUpdate:modelValue":m=>r.receivedQty=m,type:"number",label:e.$t("order.quantity"),dense:"","lazy-rules":"",rules:[m=>m&&m>0||e.$t("order.enterValidQuantity")]},null,8,["modelValue","onUpdate:modelValue","label","rules"])]),_:2},1024)]),_:2},1024)]),_:2},1024),c<(((i=e.cartContent)==null?void 0:i.length)||0)-1?(u(),y(L,{key:0,spaced:""})):U("",!0)])}),128))]),_:1},8,["onSubmit"])]),_:1})}var te=$(oe,[["render",ne]]);const ae=v({name:"OrdersPage",components:{OrderGrid:re,OrderConfirm:te},emits:[...W.emits],setup(){h();const e=j(),o=b(!1),a=()=>{e.push({name:"neworder"})},s={id:"",providerId:"",reference:"",orderDate:new Date,storeId:""},d=b(s);var l=b(null);return{dialogOpened:o,editingRow:d,gotoNewOrder:a,sidePanel:l,openSidePanel:(m,f)=>{l.value=m,f!=null&&f.products;let I=Object.create(f);d.value=I},closeSidePanel:()=>{l.value=null,d.value=s},handleOrderConfirmed:()=>{console.log("order confirmed handled")}}}});function de(e,o,a,s,d,l){const r=S("order-grid"),c=S("order-confirm");return u(),w(V,null,[n(P,null,{default:t(()=>[n(r,{onNewOrderClick:e.gotoNewOrder,onConfirmRowClick:o[0]||(o[0]=i=>e.openSidePanel("confirm",i))},null,8,["onNewOrderClick"])]),_:1}),n(R,{"model-value":e.sidePanel==="confirm",side:"right",bordered:""},{default:t(()=>[n(c,{modelValue:e.editingRow.products,"onUpdate:modelValue":o[1]||(o[1]=i=>e.editingRow.products=i),"order-reference":e.editingRow.reference,onOrderConfirmed:e.handleOrderConfirmed},null,8,["modelValue","order-reference","onOrderConfirmed"])]),_:1},8,["model-value"])],64)}var we=$(ae,[["render",de]]);export{we as default};
