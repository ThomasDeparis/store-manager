import{Q as I}from"./QPage.c5ade77a.js";import{Q as U}from"./QDrawer.d37ed123.js";import{d as V,c as k,r as p,_ as g,H as v,R as Q,j as r,J as a,O as y,aj as c,Q as F,P,G as $,I as R,ak as j,al as B,am as D,K as A,F as G}from"./index.3db6d354.js";import{Q as K,a as C}from"./QTooltip.1c55f155.js";import{Q as O,a as H,E as J}from"./errortype.ca0a8788.js";import{u as h,P as L}from"./product-store.bd037714.js";import{u as E}from"./user-store.7c7798a7.js";import{u as q}from"./vue-i18n.runtime.f032216e.js";import{Q as M}from"./QForm.1abbfd2a.js";import{S as N}from"./SidePanel.105ac781.js";import{t as S}from"./index.e5b097fe.js";import{u as W}from"./notify-handler.3dcb331b.js";import"./QItem.02ecd005.js";const X=V({name:"ProductGrid",emits:["new-product-click","edit-row-click","detail-row-click"],setup(){const{t:e}=q(),l=h(),d=E(),s=[{name:"actions",label:"",align:"center"},{name:"reference",label:e("product.reference"),field:"reference",sortable:!0},{name:"providerreference",label:e("product.providerRef"),field:"providerReference",sortable:!0},{name:"name",label:e("product.name"),field:"name",sortable:!0},{name:"quantity",label:e("product.quantity"),field:"quantity",sortable:!0},{name:"sellprice",label:e("product.sellPrice"),field:"sellPrice",format:t=>`${t} \u20AC`}],n=()=>{l.loadProducts(d.currentStore)},i=k(()=>l.products.map(function(t){return{...t,actions:null}}));return{filter:p(""),columns:s,rows:i,loadProducts:n,loading:l.isLoading}}}),Y={class:"q-pa-md"},Z=P("div",{class:"text-body2"},"\xC9diter",-1),_=P("div",{class:"text-body2"},"D\xE9tail",-1),x=P("div",{class:"text-body2"},"Dupliquer",-1);function ee(e,l,d,s,n,i){return v(),Q("div",Y,[r(H,{class:"body--light","grid-header":"",bordered:"",rows:e.rows,columns:e.columns,"row-key":"reference",filter:e.filter,"rows-per-page-options":[50,100]},{top:a(()=>[r(y,{color:"primary",label:e.$t("product.newProduct"),onClick:l[0]||(l[0]=t=>e.$emit("new-product-click"))},null,8,["label"]),r(K),r(c,{dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":l[1]||(l[1]=t=>e.filter=t)},{append:a(()=>[r(F,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":a(t=>[r(O,{props:t},{default:a(()=>[r(y,{class:"q-mr-sm",icon:"edit",push:"",round:"",color:"amber-7",size:"sm",onClick:o=>e.$emit("edit-row-click",t.row)},{default:a(()=>[r(C,null,{default:a(()=>[Z]),_:1})]),_:2},1032,["onClick"]),r(y,{icon:"visibility",class:"q-mr-sm",push:"",round:"",color:"primary",size:"sm",onClick:o=>e.$emit("detail-row-click",t.row)},{default:a(()=>[r(C,null,{default:a(()=>[_]),_:1})]),_:2},1032,["onClick"]),r(y,{icon:"copy_all",round:"",push:"",color:"grey",size:"sm"},{default:a(()=>[r(C,null,{default:a(()=>[x]),_:1})]),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),r(y,{icon:"search",onClick:e.loadProducts},null,8,["onClick"])])}var le=g(X,[["render",ee]]);const oe=V({name:"ProductCreation",emits:["close","product-created","product-creation-failed"],components:{SidePanel:N},setup(e,l){const d=p(),s=p(""),n=p(""),i=p(0),t=p(""),o=h(),f=E(),u=()=>{var b;s.value="",n.value="",i.value=0,t.value="",(b=d.value)==null||b.resetValidation()};return{form:d,reference:s,providerReference:n,sellPrice:i,name:t,onSubmit:async()=>{var b;try{const m={reference:s.value,providerReference:n.value,sellPrice:i.value,name:t.value,quantity:0,storeId:f.currentStore,lastChangeUserId:(b=f.userData)==null?void 0:b.uid},w=await o.addProduct(m);l.emit("product-created",w),u()}catch(m){l.emit("product-creation-failed",m)}}}}}),re={class:"row justify-center"};function te(e,l,d,s,n,i){const t=$("side-panel");return v(),R(t,{title:e.$t("product.newProduct"),onClose:l[4]||(l[4]=o=>e.$emit("close"))},{default:a(()=>[r(M,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:a(()=>[r(c,{filled:"",modelValue:e.reference,"onUpdate:modelValue":l[0]||(l[0]=o=>e.reference=o),label:e.$t("product.reference"),"lazy-rules":"",rules:[o=>o&&o.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),r(c,{filled:"",modelValue:e.providerReference,"onUpdate:modelValue":l[1]||(l[1]=o=>e.providerReference=o),label:e.$t("product.providerReference")},null,8,["modelValue","label"]),r(c,{filled:"",modelValue:e.name,"onUpdate:modelValue":l[2]||(l[2]=o=>e.name=o),label:e.$t("product.name"),"lazy-rules":"",rules:[o=>o&&o.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),r(c,{filled:"",suffix:"\u20AC",mask:"#.##","fill-mask":"0","reverse-fill-mask":"",modelValue:e.sellPrice,"onUpdate:modelValue":l[3]||(l[3]=o=>e.sellPrice=o),"input-class":"text-right",label:e.$t("product.sellPrice"),"lazy-rules":"",rules:[o=>o!==null&&o!==""&&o>0||e.$t("product.enterValidSellPrice")]},null,8,["modelValue","label","rules"]),P("div",re,[r(y,{label:e.$t("buttons.create"),type:"submit",color:"primary"},null,8,["label"])])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var de=g(oe,[["render",te]]);const ne=V({name:"ProductEdit",props:{readonlyMode:{type:Boolean,default:!1},modelValue:{type:Object,required:!0}},emits:["close","update:modelValue","update:readonlyMode","product-edit-failed"],components:{SidePanel:N},setup(e,l){const d=k(()=>e.modelValue),s=j(e.readonlyMode);B(()=>s.value=e.readonlyMode);const n=h(),i=E();return{editing:d,isReadonly:s,onSubmit:async()=>{var o;try{d.value.lastChangeUserId=(o=i.userData)==null?void 0:o.uid,await n.editProduct(d.value),l.emit("update:modelValue",d.value)}catch(f){l.emit("product-edit-failed",f)}}}}}),ae={class:"row"},se={class:"row justify-center"};function ie(e,l,d,s,n,i){const t=$("side-panel");return v(),R(t,{title:e.$t("product.detail"),onClose:l[5]||(l[5]=o=>e.$emit("close"))},{default:a(()=>[P("div",ae,[r(D,{class:"","model-value":e.isReadonly,color:"green",label:e.$t("forms.editMode"),"true-value":!1,"false-value":!0,"onUpdate:modelValue":l[0]||(l[0]=o=>e.$emit("update:readonlyMode",e.isReadonly))},null,8,["model-value","label"])]),r(M,{onSubmit:e.onSubmit,ref:"form",class:"q-gutter-md q-pa-sm"},{default:a(()=>[r(c,{filled:"",modelValue:e.editing.reference,"onUpdate:modelValue":l[1]||(l[1]=o=>e.editing.reference=o),label:e.$t("product.reference"),readonly:"","lazy-rules":"",rules:[o=>o&&o.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","rules"]),r(c,{filled:"",modelValue:e.editing.providerReference,"onUpdate:modelValue":l[2]||(l[2]=o=>e.editing.providerReference=o),readonly:e.isReadonly,label:e.$t("product.providerReference")},null,8,["modelValue","readonly","label"]),r(c,{filled:"",modelValue:e.editing.name,"onUpdate:modelValue":l[3]||(l[3]=o=>e.editing.name=o),label:e.$t("product.name"),readonly:e.isReadonly,"lazy-rules":"",rules:[o=>o&&o.length>0||e.$t("forms.mandatory")]},null,8,["modelValue","label","readonly","rules"]),r(c,{filled:"",suffix:"\u20AC",mask:"#.##","fill-mask":"0","reverse-fill-mask":"",modelValue:e.editing.sellPrice,"onUpdate:modelValue":l[4]||(l[4]=o=>e.editing.sellPrice=o),"input-class":"text-right",label:e.$t("product.sellPrice"),readonly:e.isReadonly,"lazy-rules":"",rules:[o=>o!==null&&o!==""&&o>0||e.$t("product.enterValidSellPrice")]},null,8,["modelValue","label","readonly","rules"]),P("div",se,[e.isReadonly?A("",!0):(v(),R(y,{key:0,label:e.$t("buttons.edit"),type:"submit",color:"primary"},null,8,["label"]))])]),_:1},8,["onSubmit"])]),_:1},8,["title"])}var ue=g(ne,[["render",ie]]);function me(e){return e.errorType===J.Technical?(console.log(e),S("common.technicalError")):(e==null?void 0:e.messageKey)===L.ReferenceExists?S("product.referenceExists"):S("common.technicalError")}const ce=V({name:"ProductsPage",components:{ProductGrid:le,ProductCreation:de,ProductEdit:ue},setup(){const{t:e}=q(),l=W(),d={id:"",name:"",quantity:0,sellPrice:0,reference:"",storeId:"",providerReference:"",lastChangeUserId:""},s=p(d);var n=p(null);const i=(m,w)=>{n.value=m;let z=Object.create(w);s.value=z},t=()=>{n.value=null,s.value=d},o=k(()=>n.value==="detail");return{handleTechnicalError:m=>l.NotifyError(me(m)),handleNewProduct:()=>{l.NotifySuccess(e("product.created"))},handleProductEdited:()=>{l.NotifySuccess(e("product.edited")),t()},sidePanel:n,openSidePanel:i,closeSidePanel:t,emptyRow:d,editingRow:s,readonlyEditMode:o,handleEditModeChanged:m=>{n.value=m?"edit":"detail"}}}});function pe(e,l,d,s,n,i){const t=$("product-grid"),o=$("product-creation"),f=$("product-edit");return v(),Q(G,null,[r(I,null,{default:a(()=>[r(t,{onNewProductClick:l[0]||(l[0]=u=>e.openSidePanel("new",e.emptyRow)),onEditRowClick:l[1]||(l[1]=u=>e.openSidePanel("edit",u)),onDetailRowClick:l[2]||(l[2]=u=>e.openSidePanel("detail",u))})]),_:1}),r(U,{"model-value":e.sidePanel==="new",side:"right",bordered:""},{default:a(()=>[r(o,{onProductCreated:e.handleNewProduct,onProductCreationFailed:e.handleTechnicalError,onClose:e.closeSidePanel},null,8,["onProductCreated","onProductCreationFailed","onClose"])]),_:1},8,["model-value"]),r(U,{"model-value":e.sidePanel==="edit"||e.sidePanel==="detail",side:"right",bordered:""},{default:a(()=>[r(f,{modelValue:e.editingRow,"onUpdate:modelValue":[l[3]||(l[3]=u=>e.editingRow=u),e.handleProductEdited],"readonly-mode":e.readonlyEditMode,onClose:e.closeSidePanel,"onUpdate:readonlyMode":e.handleEditModeChanged,onProductEditFailed:e.handleTechnicalError},null,8,["modelValue","readonly-mode","onClose","onUpdate:modelValue","onUpdate:readonlyMode","onProductEditFailed"])]),_:1},8,["model-value"])],64)}var he=g(ce,[["render",pe]]);export{he as default};
